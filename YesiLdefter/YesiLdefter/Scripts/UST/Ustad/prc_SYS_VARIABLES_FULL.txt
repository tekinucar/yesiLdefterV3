

/* Bununla tüm firmaya ait proje öndeðerleri okunuyor */

CREATE PROCEDURE [prc_SYS_VARIABLES_FULL] (@firmId int)  
AS BEGIN 
 
  -- clientType
  -- 1 Grup Firma
  -- 2 Firma
  -- 3 Þube
  -- 4 Bölüm
  -- 5 Departman
  -- 6 Personel
  -- 7 Bilgisayar 

    Select 
       SYSVAR.*
      -- ,@clientType            LKP_CLIENT_TYPE     
	  -- ,@clientId              LKP_CLIENT_ID
      ,MSVAR.MODUL_CODE       LKP_MODUL_CODE
      ,MSVAR.VARIABLE_CODE    LKP_VARIABLE_CODE
      ,MSVAR.VARIABLE_CAPTION LKP_VARIABLE_CAPTION
      ,MSVAR.PROP_SEARCH      LKP_PROP_SEARCH
      , ( CASE MSVAR.FJOIN_TABLE_NAME 
          WHEN 'HP_FINANS' THEN HPFIN.HP_TAMADI 
         /*
          WHEN 'HP_FIRMS'  THEN HPFIRMS.HP_NAME 
          WHEN 'HP_CARI'   THEN HPCARI.TAMADI 
          WHEN 'HP_IL'     THEN HPIL.IL_ADI
         */
          ELSE  MSVAR.FJOIN_TABLE_NAME
          END ) LKP_CLIENT_VALUE
     
     
  from MS_VARIABLES MSVAR
    left outer join SYS_VARIABLES SYSVAR on ( 
         MSVAR.VARIABLE_CODE = SYSVAR.VARIABLE_CODE
    /*[SYSVAR].DEFAULT_VALUE*/
    /*[SYSVAR].KRITERLER*/ 
         and   SYSVAR.FIRM_ID = @firmId
        -- and   SYSVAR.CLIENT_TYPE = @clientType
        -- and   SYSVAR.CLIENT_ID = @clientId
        )
  
  left outer join HP_FINANS HPFIN on ( 
       MSVAR.FJOIN_TABLE_NAME = 'HP_FINANS' 
       and Convert(Int, isnull(SYSVAR.CLIENT_VALUE,0)) = HPFIN.ID 
       )

  where 0 = 0
  /*[MSVAR].DEFAULT_VALUE*/
  /*[MSVAR].KRITERLER*/ 
  -- and   MSVAR.MODUL_CODE = @modulCode
   

  ORDER BY MSVAR.MODUL_CODE, MSVAR.LINE_NO
  
END;

    




/*MySQL_BEGIN*/


DELIMITER $$
DROP PROCEDURE IF EXISTS `prc_SYS_VARIABLES_FULL` $$
CREATE PROCEDURE `prc_SYS_VARIABLES_FULL` ( in firmId int )
BEGIN  

    Select 
       SYSVAR.*
      ,MSVAR.MODUL_CODE       LKP_MODUL_CODE
      ,MSVAR.VARIABLE_CODE    LKP_VARIABLE_CODE
      ,MSVAR.VARIABLE_CAPTION LKP_VARIABLE_CAPTION
      ,MSVAR.PROP_SEARCH      LKP_PROP_SEARCH
      , ( CASE MSVAR.FJOIN_TABLE_NAME 
          WHEN 'HP_FINANS' THEN HPFIN.HP_TAMADI 
          /*
          WHEN 'HP_FIRMS'  THEN HPFIRMS.HP_NAME 
          WHEN 'HP_CARI'   THEN HPCARI.TAMADI 
          WHEN 'HP_IL'     THEN HPIL.IL_ADI
          */
          ELSE  MSVAR.FJOIN_TABLE_NAME
          END ) LKP_CLIENT_VALUE
     
  from MS_VARIABLES MSVAR
    left outer join SYS_VARIABLES SYSVAR on ( 
         MSVAR.VARIABLE_CODE = SYSVAR.VARIABLE_CODE
    /*[SYSVAR].DEFAULT_VALUE*/
    /*[SYSVAR].KRITERLER*/ 
         and   SYSVAR.FIRM_ID = @firmId
        -- and   SYSVAR.CLIENT_TYPE = @clientType
        -- and   SYSVAR.CLIENT_ID = @clientId
        )
  
  left outer join HP_FINANS HPFIN on ( 
       MSVAR.FJOIN_TABLE_NAME = 'HP_FINANS' 
       and ifnull(SYSVAR.CLIENT_VALUE,0) = HPFIN.ID 
       )

  where 0 = 0
  
  ORDER BY MSVAR.MODUL_CODE, MSVAR.LINE_NO;

END $$;





 
 /* 
    DÝÐER TABLOLARDAN ÇEKÝLEN HESAPLAR 

    left outer join HP_FIRM [HPFIRM] on ( 
         [MSVAR].FJOIN_TABLE_NAME = 'HP_FIRM' 
         and Convert(Int, isnull([SYSVAR].CLIENT_VALUE,0)) = [HPFIRM].ID ) 
    left outer join HP_CARI [HPCARI] on ( 
         [MSVAR].FJOIN_TABLE_NAME = 'HP_CARI' 
         and Convert(Int, isnull([SYSVAR].CLIENT_VALUE,0)) = [HPCARI].ID ) 
    left outer join HP_FINANS [HPFIN] on ( 
         [MSVAR].FJOIN_TABLE_NAME = 'HP_FINANS' 
         and Convert(Int, isnull([SYSVAR].CLIENT_VALUE,0)) = [HPFIN].ID ) 
    left outer join HP_IL [HPIL] on ( 
         [MSVAR].FJOIN_TABLE_NAME = 'HP_IL' 
         and Convert(Int, isnull([SYSVAR].CLIENT_VALUE,0)) = [HPIL].IL_KODU ) 

    WHERE 0 = 0
*/


 