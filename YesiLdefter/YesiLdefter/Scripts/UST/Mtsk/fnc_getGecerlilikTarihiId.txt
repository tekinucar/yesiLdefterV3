/*CreateFunction*/

CREATE FUNCTION [dbo].[fnc_getGecerlilikTarihiId](@FirmId int, @KonuTipiId int, @Tarih date)  
RETURNS int
AS   
BEGIN 
  declare @responseId int = 0
  /*
  declare @FirmId int = 11
  declare @KonuTipiId int = 21101 -- teorik ders saati tarihi
  declare @Tarih date = getdate()

Id      KonuTipi
21101   Teorik saatler
21102   Uygulama saatleri
21103   Sınav ücreti
21104   Teodrik ders ücreti
21105  Uygulama ders ücreti
  */

  Select top 1 @responseId = gtarih.Id 
  From GecerlilikTarihi as gtarih 
  Where gtarih.FirmId = @FirmId
  and   gtarih.KonuTipiId = @KonuTipiId
  and   gtarih.Tarih <= @Tarih
  order by Tarih desc  -- olması gerekiyor
  --order by Tarih --desc  ???? hatırlamadım

  RETURN @responseId;
END; -- function

/*CreateFunctionEnd*/
