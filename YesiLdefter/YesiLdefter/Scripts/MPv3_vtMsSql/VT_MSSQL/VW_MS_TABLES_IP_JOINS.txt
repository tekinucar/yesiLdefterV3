


CREATE VIEW [dbo].[VW_MS_TABLES_IP_JOINS]  
AS
 (

-- IP NİN BAĞLI OLDUĞU DİĞER IP LER
SELECT  
     A.TABLE_CODE       LKP_TABLE_CODE
   , A.IP_CODE          LKP_IP_CODE
   , A.TABLE_CODE + '.' + A.IP_CODE  LKP_TABLEIPCODE
   , A.TABLEIPCODE      LKP_JOIN_TABLEIPCODE 
   , 'MASTER_DETAIL'    LKP_FIELD_NAME
   FROM (  
     SELECT DISTINCT(MASTER_TABLEIPCODE) TABLEIPCODE, TABLE_CODE, IP_CODE   FROM MS_FIELDS_IP 
     WHERE DEFAULT_TYPE = 31
) A

UNION ALL

-- PROP_NAVIGATOR İÇİNDE KULLANILAN IP LER
SELECT 
     A.TABLE_CODE       LKP_TABLE_CODE 
   , A.IP_CODE          LKP_IP_CODE 
   , A.TABLE_CODE + '.' + A.IP_CODE  LKP_TABLEIPCODE
   , X.TABLEIPCODE      LKP_JOIN_TABLEIPCODE
   , 'PROP_NAVIGATOR'   LKP_FIELD_NAME
   FROM MS_TABLES_IP A
   LEFT OUTER JOIN 
   (
     SELECT TABLE_CODE + '.' + IP_CODE TABLEIPCODE FROM MS_TABLES_IP 
   ) X ON ( X.TABLEIPCODE <> '') 
   WHERE A.PROP_NAVIGATOR LIKE '%' + X.TABLEIPCODE +'%'

UNION ALL

-- PROP_SUBVIEW İÇİNDE KULLANILAN IP LER
SELECT 
     A.TABLE_CODE       LKP_TABLE_CODE 
   , A.IP_CODE          LKP_IP_CODE 
   , A.TABLE_CODE + '.' + A.IP_CODE  LKP_TABLEIPCODE
   , X.TABLEIPCODE      LKP_JOIN_TABLEIPCODE
   , 'PROP_SUBVIEW'     LKP_FIELD_NAME
   FROM MS_TABLES_IP A 
   LEFT OUTER JOIN 
   (
     SELECT TABLE_CODE + '.' + IP_CODE TABLEIPCODE FROM MS_TABLES_IP 
   ) X ON ( X.TABLEIPCODE <> '')
   WHERE A.PROP_SUBVIEW LIKE '%' + X.TABLEIPCODE +'%'

UNION ALL

-- PROP_RUNTIME İÇİNDE KULLANILAN IP LER
SELECT 
     A.TABLE_CODE       LKP_TABLE_CODE 
   , A.IP_CODE          LKP_IP_CODE 
   , A.TABLE_CODE + '.' + A.IP_CODE  LKP_TABLEIPCODE
   , X.TABLEIPCODE      LKP_JOIN_TABLEIPCODE
   , 'PROP_RUNTIME'     LKP_FIELD_NAME
   FROM MS_TABLES_IP A
   LEFT OUTER JOIN 
   (
     SELECT TABLE_CODE + '.' + IP_CODE TABLEIPCODE FROM MS_TABLES_IP 
   ) X ON ( X.TABLEIPCODE <> '')
   WHERE A.PROP_RUNTIME LIKE '%' + X.TABLEIPCODE +'%'

UNION ALL   

-- PROP_SEARCH İÇİNDE KULLANILAN IP LER
SELECT 
     A.TABLE_CODE       LKP_TABLE_CODE 
   , A.IP_CODE          LKP_IP_CODE 
   , A.TABLE_CODE + '.' + A.IP_CODE  LKP_TABLEIPCODE
   , X.TABLEIPCODE      LKP_JOIN_TABLEIPCODE
   , 'PROP_SEARCH'      LKP_FIELD_NAME
   FROM MS_TABLES_IP A
   LEFT OUTER JOIN 
   (
     SELECT TABLE_CODE + '.' + IP_CODE TABLEIPCODE FROM MS_TABLES_IP 
   ) X ON ( X.TABLEIPCODE <> '')
   WHERE A.PROP_SEARCH LIKE '%' + X.TABLEIPCODE +'%'

UNION ALL 

-- EXTERNAL_IP_CODE İÇİNDE KULLANILAN IP LER
SELECT 
     A.TABLE_CODE       LKP_TABLE_CODE 
   , A.IP_CODE          LKP_IP_CODE 
   , A.TABLE_CODE + '.' + A.IP_CODE  LKP_TABLEIPCODE
   , X.TABLEIPCODE      LKP_JOIN_TABLEIPCODE
   , 'EXTERNAL_IP_CODE' LKP_FIELD_NAME
   FROM MS_TABLES_IP A
   LEFT OUTER JOIN 
   (
     SELECT TABLE_CODE + '.' + IP_CODE TABLEIPCODE FROM MS_TABLES_IP 
   ) X ON ( X.TABLEIPCODE <> '')
   WHERE A.EXTERNAL_IP_CODE LIKE '%' + X.TABLEIPCODE +'%'


  ) -- VW END 