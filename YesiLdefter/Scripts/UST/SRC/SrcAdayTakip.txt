/*CreateTable*/

begin transaction

 create table SrcAdayTakip
 (
   Id                    Int IDENTITY(1,1) not null, 
   FirmId                Int       not null,
   TalepId               Int       not null, 
   AdayId                Int       not null, 
   DonemTipiId           Int           null,
   GrupTipiId            SmallInt      null,
   SubeTipiId            SmallInt      null,
   
   -- MtskAdayTalep trigger içinden prc_SrcAdayTakipSingleSet çağırılıyor
   -- 10 kayıt aşaması
   TalepTipiId            SmallInt     null, /*  prc_SrcAdayTakipSingleSet üzerinden işaretleniyor : 1. sertifika, 2. (2.+4 hak), 3. Nakil 2.+4hak, 4. 100Ceza, 5. Özel Uyg Ders   */ 
   KayitTipiId            SmallInt     null, /*  prc_SrcAdayTakipSingleSet üzerinden işaretleniyor : 1. Ön kayıt, 2. Kayıt aşamasında, 3. Kesin Kayıt ...  */ 
   ZamanlamaTipiId        SmallInt     null, /*  prc_SrcAdayTakipSingleSet üzerinden işaretleniyor : */
   IsGrupSubeYok          Bit          null, /*  prc_SrcAdayTakipSingleSet üzerinden işaretleniyor : grup veya şubesi belli değilse  */
   IsActive               Bit          null, /*  Aktif talep : süreci devam edenler = 1, değilse = 0 : sorgularda kolaylık olsun diye var  */ 
   MebbisKurumOnayi       Bit          null, /*  prc_SrcAdayTakipSingleSet üzerinden işaretleniyor : 0-Onaysız, 1-Onaylandı */	
   MebbisDurumTipiId      SmallInt     null, /*  prc_SrcAdayTakipSingleSet üzerinden işaretleniyor : detayı aşağıda*/
   SertifikaYasSiniri     SmallInt     null, /*  trg_MtskAdayTalep          üzerinden prc_MtskAdayTalepYasiniHesapla çağırılıyor : almak istediği sertifikanın yaş sınırı  */  
   YasOnayiTipiId         SmallInt     null, /*  trg_MtskAdayTalep          üzerinden prc_MtskAdayTalepYasiniHesapla çağırılıyor : */
   YasHazirTarihi         Date         null, /*  trg_MtskAdayTalep          üzerinden prc_MtskAdayTalepYasiniHesapla çağırılıyor : yaş sınırını doldurduğu tarih */
   DeneyimSartiTipiId     SmallInt     null, /*  prc_SrcAdayTakipSingleSet içinde fnc_getSertifikaDeneyimSarti ile tespit ediliyor */       
   IsDeneyimEnAz          Bit          null, /*  prc_SrcAdayTakipSingleSet üzerinden işaretleniyor  */
   DeneyimSertifikaTipiId SmallInt     null, /*  prc_SrcAdayTakipSingleSet üzerinden işaretleniyor  */
   OzurDurumuTipiId       SmallInt     null, /*  trg_MtskAdaySaglik         üzerinden işaretleniyor  */
   OkutmanTalebi          Bit          null, /*  trg_MtskAdaySaglik         üzerinden işaretleniyor  */
   TercumanTalebi         Bit          null, /*  trg_MtskAdaySaglik         üzerinden işaretleniyor  */
   YabanciDilTipiId       SmallInt     null, /*  trg_MtskAdaySaglik         üzerinden işaretleniyor  */
   IsKontejan             Bit          null, /*  trg_MtskAdayUcret          üzerinden işaretleniyor  */
   AracTipiId             SmallInt     null, /*  manuel, otomatik, engelli, 125 cc altı */
   
   -- MtskAdayAdliSicil, ...Adres, ...Imza, ...Ogrenim, ...Saglik, ...Sozlesme MtskAdayBelgeler tablosunu tetikliyor
   -- MtskAdayBelgeler trigger da buraya yazıyor
   -- 30
   BelgelerGeldi          Bit          null, /* prc_SrcAdayTakipSingleSet üzerinden işaretleniyor : tamamı geldiyse */
   BelgelerTarandi        Bit          null, /* trg_MtskAdayBelgeler       üzerinden işaretleniyor : tamamı tarandıysa */
   BelgelerYuklendi       Bit          null, /* trg_MtskAdayBelgeler       üzerinden işaretleniyor : tamamı yüklendiyse */

   -- 40 ödemeleri
   BorcDurumuTipiId         SmallInt      null,
   
   --100 eSınav aşaması
   TeorikBaslamaTarihi    Date         null,
   TeorikBitisTarihi      Date         null,
   --TeorikDersToplami      SmallInt     null, iptal gerek yok
   TeorikDersTipiId       SmallInt     null,--104
   
   -- 110
   GirecegiSinavTipiId    SmallInt     null, /* 0. Tanımsız, 1. Teo + Uyg, 2. Sadece Teo, 3. Sadece Uyg. */ 
   eSinavNo               SmallInt     null, /* gireceği sınav no */
   eSinavDurumTipiId      SmallInt     null,
   eSinavAdayTarihi       Date         null, /* Adayın kendisinin belirttiği tarih */
   eSinavPlanTarihi       Date         null, /* Kullanıcının planladığı tarih */
   eSinavMuracatTarihi    Date         null, /* Müracat Tarihi */
   eSinavUcretTipiId      SmallInt     null, /* kendisi yatıracak, biz yatıracağız */
   IseSinavaGirebilir     Bit          null, /* e-Sınava girebilir veya giremez */
   IseSinavBTeslimEdildi  Bit          null, /* e-Sınav belgesi kursiyere teslim edildi veya edilmedi */

   -- 120
   eSinavNoGirdigi        SmallInt     null,  
   eSinavSonucTipiId      SmallInt     null, /* Başarılı, Başarısız, Girmedi */
   eSinavSonrasiTipiId    SmallInt     null, 
   eSinavDetayId          Int          null, /* en son hangi sınavsa onun id si. sınav1 ise sınav1 in id si, 2 ise 2 nin id si, 3, 4 ... */
   eSinavBasariTarihi     Date         null,

   --190
   UygulamaliDersKredisi  SmallInt     null,
   Arti4DersKredisi       SmallInt     null,
   TelafiDersKredisi      SmallInt     null,
   BasarisizDersKredisi   SmallInt     null,

   --200 uygulama ders + Sınav aşaması
   IsUygulamaliDersPlanli Bit          null,
   UygulamaBaslamaTarihi  Date         null,
   UygulamaBitisTarihi    Date         null,
   SimulatorDersToplami   SmallInt     null,
   EgitimAlaniDersToplami SmallInt     null,
   AkanTrafikDersToplami  SmallInt     null, /* prc_MtskUygulamaDersPlaniSaatleriGuncelle  içinde hesplanıyor */
   UygulamaliDersToplami  SmallInt     null, /* prc_MtskUygulamaDersPlaniSaatleriGuncelle  içinde hesplanıyor */
   UygulamaliDersTipiId   SmallInt     null,
   IsUygulamaliDersMebbis Bit          null, /* Mebbise aktarılmadı, aktarrıldı */

   --210
   IsTelafiDersPlanli     Bit          null,
   TelafiDersNo           SmallInt     null,
   TelafiBaslamaTarihi    Date         null,
   TelafiBitisTarihi      Date         null,
   TelafiDersToplami      SmallInt     null,
   TelafiDersTipiId       SmallInt     null,
   IsTelafiDersMebbis     Bit          null, /* Mebbise aktarılmadı, aktarrıldı */

   --220
   IsBasarisizDersPlanli  Bit          null,
   BasarisizDersNo        SmallInt     null,
   BasarisizBaslamaTarihi Date         null,
   BasarisizBitisTarihi   Date         null,
   BasarisizDersToplami   SmallInt     null,
   BasarisizDersTipiId    SmallInt     null,
   IsBasarisizDersMebbis  Bit          null, /* Mebbise aktarılmadı, aktarrıldı */
      
   --230
   IsArti4DersPlanli           Bit          null,
   Arti4BaslamaTarihi          Date         null,
   Arti4BitisTarihi            Date         null,
   Arti4EgitimAlaniDersToplami SmallInt     null,
   Arti4AkanTrafikDersToplami  SmallInt     null, /* prc_MtskUygulamaDersPlaniSaatleriGuncelle  içinde hesplanıyor */
   Arti4DersToplami            SmallInt     null, /* prc_MtskUygulamaDersPlaniSaatleriGuncelle  içinde hesplanıyor */
   Arti4DersTipiId             SmallInt     null,
   IsArti4DersMebbis           Bit          null, /* Mebbise aktarılmadı, aktarrıldı */

   -- 240 
   PlanlanacakEgitimTipiId SmallInt     null, 
   uSinavaHazirmiTipiId    SmallInt     null, /* 1. Onay, 2. Sınav için hazır değil : bu seçimi usta öğretici karar veriyor */
   IsUygSinavMebbisOnayi   Bit          null, /* uSinavDurumTipi = 4, 'Uygulama sınavı için MEBBİS de onaylanacak' için gerekli */
   IsRandevuPlanlandi      Bit          null, /* Randevu tarafında planlanınca burası True olacak */
   IsRandevuMebbis         Bit          null, /* Randevu Mebbise aktarılınca */
   RandevuTarihi           Date         null, /* Randevu tarafında planınca plan tarihi buraya set ediliyor */ 
   RandevuSaatTipiId       SmallInt     null, /* Randevu tarafında planınca plan tarihi buraya set ediliyor */   
   RandevuEgitimAraciId    Varchar(10)  null, /* uygulama sınav randevusundaki araç */  
   RandevuPersonelId       Varchar(20)  null, /* uygulama sınavında sorumlu olan öğretmen */  

   -- 250 
   uSinavNo                SmallInt     null,
   uSinavDurumTipiId       SmallInt     null,
   uSinavAdayTarihi        Date         null, /* Adayın kendisinin belirttiği tarih */
   uSinavPlanTarihi        Date         null, /* Kullanıcının planladığı tarih */
   --uSinavRandevuTarihi     Date         null, /* iptal, yukarıda RandevuTarihi eklendi */
   uSinavUcretTipiId       SmallInt     null, /* kendisi yatıracak, biz yatıracağız */
   IsuSinavaGirebilir      Bit          null, /* uygulama sınavına girebilir veya giremez */
   IsuSinavBTeslimEdildi   Bit          null, /* uygulama sınav belgesi kursiyere teslim edildi veya edilmedi */

   -- 260
   uSinavNoGirdigi         SmallInt     null,  
   uSinavSonucTipiId       SmallInt     null, /* Başarılı, Başarısız, Girmedi */
   uSinavSonrasiTipiId     SmallInt     null, 
   uSinavDetayId           Int          null, /* en son hangi sınavsa onun id si. sınav1 ise sınav1 in id si, 2 ise 2 nin id si, 3, 4 ... */
   uSinavBasariTarihi      Date         null,

   --270 sertifika aşaması
   SertifikaDurumTipiId    SmallInt     null,
   SertifikaTarihi         Date         null,
   DosyaYakti              Bit          null, -- false/true
   
   -- 300
   Asama1TipiId            SmallInt     null, /* Şu anda aday hangi aşamada */
   Asama1DetayTipiId       SmallInt     null, /* Şu anda aday hangi aşamada */
   Asama2TipiId            SmallInt     null, /* Şu anda aday hangi aşamada */
   Asama2DetayTipiId       SmallInt     null, /* Şu anda aday hangi aşamada */

   constraint		pk_SrcAdayTakip primary key (Id)
 )
  
 grant select, insert, update, delete on SrcAdayTakip to public

 create index X_SrcAdayTakip01 on SrcAdayTakip (FirmId, TalepId)
 create index X_SrcAdayTakip02 on SrcAdayTakip (AdayId)
 create index X_SrcAdayTakip03 on SrcAdayTakip (DonemTipiId,GrupTipiId,SubeTipiId)
 create index X_SrcAdayTakip04 on SrcAdayTakip (KayitTipiId)
 create index X_SrcAdayTakip05 on SrcAdayTakip (eSinavDurumTipiId)
 create index X_SrcAdayTakip06 on SrcAdayTakip (uSinavDurumTipiId)
  
   

commit transaction

/*CreateTableEnd*/


/*CreateLkpTable*/

begin transaction


-- ------------------------------------------------------- 
-- TalepTipiId
-- ------------------------------------------------------- 
IF EXISTS (Select * From sys.objects WHERE name = 'SrcAdayTakipTalepTipi')
drop table [Lkp].[SrcAdayTakipTalepTipi]

create table [Lkp].[SrcAdayTakipTalepTipi]
(
   Id               Int Unique not null, 
   TalepTipi        nVarchar(50)   null,
   KonuGrupId       SmallInt       null,
   KonuId           Int            null,
   KonuCaption      nVarchar(20)   null,
   ChartCaption     nVarchar(20)   null,
   FormCaption      nVarchar(15)   null,
   
   constraint  pk_SrcAdayTakipTalepTipi primary key (Id)
)

Delete from [Lkp].[SrcAdayTakipTalepTipi]
INSERT INTO [Lkp].[SrcAdayTakipTalepTipi] (Id, TalepTipi, KonuGrupId, KonuId, KonuCaption, ChartCaption, FormCaption)
 VALUES 
  ( 1,    N'SRC Sertifikası',   1, 1111, 'Talep tipi', '', ''),
  ( 2,    N'SRC5 Sertifikası',  1, 1112, 'Talep tipi', '', ''),
  ( 3,    N'SRC6 Sertifikası',  1, 1113, 'Talep tipi', '', ''),
  ( 4,    N'ODY Sertifikası',   1, 1114, 'Talep tipi', '', ''),
  ( 5,    N'ÜDY Sertifikası',   1, 1115, 'Talep tipi', '', '')



-- ------------------------------------------------------- 
-- KayitTipiId
-- ------------------------------------------------------- 
IF EXISTS (Select * From sys.objects WHERE name = 'SrcAdayTakipKayitTipi')
drop table [Lkp].[SrcAdayTakipKayitTipi]

create table [Lkp].[SrcAdayTakipKayitTipi]
(
   Id               Int Unique not null, 
   KayitTipi        nVarchar(50)   null,
   KonuGrupId       SmallInt       null,
   KonuId           Int            null,
   KonuCaption      nVarchar(20)   null,
   ChartCaption     nVarchar(20)   null,
   FormCaption      nVarchar(20)   null,

   constraint  pk_SrcAdayTakipKayitTipi primary key (Id)
)

Delete from [Lkp].[SrcAdayTakipKayitTipi]
INSERT INTO [Lkp].[SrcAdayTakipKayitTipi] (Id, KayitTipi, KonuGrupId, KonuId, KonuCaption, ChartCaption, FormCaption)
 VALUES 
  ( 0,    N'Tanımsız',                                      1, 1120, 'Kayıt durumu', '', '' ),
  ( 1,    N'Ön kayıt',                                      1, 1121, 'Kayıt durumu',  'Ön kayıt',     'Yeni aday kaydı' ),
  ( 2,    N'Kayıt aşamasında',                              1, 1122, 'Kayıt durumu',  'K.Aşamasında', 'Mebbise bağlan .' ),
  ( 3,    N'Kesin kayıt',                                   1, 1123, 'Kayıt durumu',  'Kesin kay.', '' ),
  ( 4,    N'Sertifika almaya hak kazandı',                  1, 1124, 'Kayıt durumu', '', '' ),
  ( 5,    N'Tüm teorik sınav hakkı bitti. Dosya yandı',     1, 1125, 'Kayıt durumu', '', '' ),
  ( 6,    N'Tüm uygulamalı sınav hakkı bitti',              1, 1126, 'Kayıt durumu', '', '' ),
  ( 8,    N'Diğer sebeplerden dolayı dosya kapandı',        1, 1128, 'Kayıt durumu', '', '' ),
  ( 9,    N'24 ayda kapanmamış dosya, otomatik kapatıldı',  1, 1129, 'Kayıt durumu', '', '' )

-- ------------------------------------------------------- 
-- ZamanlamaTipiId
-- ------------------------------------------------------- 
IF EXISTS (Select * From sys.objects WHERE name = 'SrcAdayTakipZamanlamaTipi')
drop table [Lkp].[SrcAdayTakipZamanlamaTipi]

create table [Lkp].[SrcAdayTakipZamanlamaTipi]
(
   Id               Int Unique not null, 
   ZamanlamaTipi    nVarchar(30)   null,
   KonuGrupId       SmallInt       null,
   KonuId           Int            null,
   KonuCaption      nVarchar(20)   null,
   ChartCaption     nVarchar(20)   null,
   FormCaption      nVarchar(15)   null,
   
   constraint  pk_SrcAdayTakipZamanlamaTipi primary key (Id)
)

Delete from [Lkp].[SrcAdayTakipZamanlamaTipi]
INSERT INTO [Lkp].[SrcAdayTakipZamanlamaTipi] (Id, ZamanlamaTipi, KonuGrupId, KonuId, KonuCaption, ChartCaption, FormCaption)
 VALUES 
  ( 0,  N'Belirsiz',                 1, 1130, 'Zamanlama',  '', '' ),
  ( 1,  N'Geçmiş dönem devam eden',  1, 1131, 'Zamanlama',  '', '' ),
  ( 2,  N'Bu dönem',                 1, 1132, 'Zamanlama',  '', '' ),
  ( 3,  N'Gelecek ay',               1, 1133, 'Zamanlama',  '', '' ),
  ( 4,  N'İleriki dönemler',         1, 1134, 'Zamanlama',  '', '' ),
  ( 5,  N'Sertifikasını hak etmiş',  1, 1135, 'Zamanlama',  '', '' )



-- ------------------------------------------------------- 
-- GrupSubeTipiId -- bu field SrcAdayTakip tablosunda yok
-- bazı koşulları takip için var
-- ------------------------------------------------------- 
IF EXISTS (Select * From sys.objects WHERE name = 'SrcAdayTakipGrupSubeTipi')
drop table [Lkp].[SrcAdayTakipGrupSubeTipi]

create table [Lkp].[SrcAdayTakipGrupSubeTipi]
(
   Id               Int Unique not null, 
   GrupSubeTipi     nVarchar(50)   null,
   KonuGrupId       SmallInt       null,
   KonuId           Int            null,
   KonuCaption      nVarchar(20)   null,
   ChartCaption     nVarchar(20)   null,
   FormCaption      nVarchar(15)   null,
   
   constraint  pk_SrcAdayTakipGrupSubeTipi primary key (Id)
)

Delete from [Lkp].[SrcAdayTakipGrupSubeTipi]
INSERT INTO [Lkp].[SrcAdayTakipGrupSubeTipi] (Id, GrupSubeTipi, KonuGrupId, KonuId, KonuCaption, ChartCaption, FormCaption)
 VALUES 
  ( 1,  N'Grup veya şubesi belli olmayan adaylar',   1, 1141, 'Grup ve şube',  '', '' )


-- ------------------------------------------------------- 
-- YasOnayiTipiId
-- ------------------------------------------------------- 
IF EXISTS (Select * From sys.objects WHERE name = 'SrcAdayTakipYasOnayiTipi')
drop table [Lkp].[SrcAdayTakipYasOnayiTipi]

create table [Lkp].[SrcAdayTakipYasOnayiTipi]
(
   Id               Int Unique not null, 
   YasOnayiTipi     nVarchar(50)   null,
   KonuGrupId       SmallInt       null,
   KonuId           Int            null,
   KonuCaption      nVarchar(20)   null,
   ChartCaption     nVarchar(20)   null,
   FormCaption      nVarchar(15)   null,
   
   constraint  pk_SrcAdayTakipYasOnayiTipi primary key (Id)
)

Delete from [Lkp].[SrcAdayTakipYasOnayiTipi]
INSERT INTO [Lkp].[SrcAdayTakipYasOnayiTipi] (Id, YasOnayiTipi, KonuGrupId, KonuId, KonuCaption, ChartCaption, FormCaption)
 VALUES 
  ( 0,    N'Tanımsız',                      1, 1210, 'Yaş onayı', '', ''),
  ( 1,    N'Yaşı tutmuyor',                 1, 1211, 'Yaş onayı', '', ''),
  ( 2,    N'Yaş için bekleme süresi dolan', 1, 1212, 'Yaş onayı', '', ''),
  ( 3,    N'Muafiyetle onaylı',             1, 1213, 'Yaş onayı', '', ''),
  ( 4,    N'Doğum tarihi yok, belirsiz',    1, 1214, 'Yaş onayı', '', ''),
  ( 5,    N'Yaşı tutuyor',                  1, 1215, 'Yaş onayı', '', ''),
  ( 6,    N'Yaş kontrolü yok',              1, 1216, 'Yaş onayı', '', '')



-- ------------------------------------------------------- 
-- DeneyimSartiTipiId
-- ------------------------------------------------------- 
IF EXISTS (Select * From sys.objects WHERE name = 'SrcAdayTakipDeneyimSartiTipi')
drop table [Lkp].[SrcAdayTakipDeneyimSartiTipi]

create table [Lkp].[SrcAdayTakipDeneyimSartiTipi]
(
   Id                Int Unique not null, 
   DeneyimSartiTipi  nVarchar(50)   null,
   KonuGrupId        SmallInt       null,
   KonuId            Int            null,
   KonuCaption       nVarchar(20)   null,
   ChartCaption      nVarchar(20)   null,
   FormCaption       nVarchar(15)   null,
   
   constraint  pk_SrcAdayTakipDeneyimSartiTipi primary key (Id)
)

Delete from [Lkp].[SrcAdayTakipDeneyimSartiTipi]
INSERT INTO [Lkp].[SrcAdayTakipDeneyimSartiTipi] (Id, DeneyimSartiTipi, KonuGrupId, KonuId, KonuCaption, ChartCaption, FormCaption)
 VALUES 
  ( 1,    N'Şart yok',     1, 1221, 'Deneyim şartı', '', ''),
  ( 2,    N'Uygun',        1, 1222, 'Deneyim şartı', '', ''),
  ( 3,    N'Uygun değil',  1, 1223, 'Deneyim şartı', '', '')



-- ------------------------------------------------------- 
-- OzelDurumuTipiId
-- ------------------------------------------------------- 
IF EXISTS (Select * From sys.objects WHERE name = 'SrcAdayTakipOzelDurumuTipi')
drop table [Lkp].[SrcAdayTakipOzelDurumuTipi]

create table [Lkp].[SrcAdayTakipOzelDurumuTipi]
(
   Id               Int Unique Not null,
   OzelDurumuTipi   nVarchar(60)   null,
   KonuGrupId       SmallInt       null,
   KonuId           Int            null,
   KonuCaption      nVarchar(20)   null,
   ChartCaption     nVarchar(20)   null,
   FormCaption      nVarchar(15)   null,

   constraint  pk_SrcAdayTakipOzelDurumuTipi primary key (Id)
)

Delete from [Lkp].[SrcAdayTakipOzelDurumuTipi]
INSERT INTO [Lkp].[SrcAdayTakipOzelDurumuTipi] (Id, OzelDurumuTipi, KonuGrupId, KonuId, KonuCaption, ChartCaption, FormCaption)
 VALUES 
  (  1, N'Özür durumu',          1, 1251, 'Özel durumu', '', ''),
  (  2, N'Okutman talebi',       1, 1252, 'Özel durumu', '', ''),
  (  3, N'Tercüman talebi',      1, 1253, 'Özel durumu', '', ''),
  (  4, N'Yabancı dil',          1, 1254, 'Özel durumu', '', ''),
  (  5, N'Yabancı uyruklar',     1, 1255, 'Özel durumu', '', ''),
  (  6, N'Etiketli kursiyerler', 1, 1256, 'Özel durumu', '', ''),
  (  7, N'Kontenjan',            1, 1257, 'Özel durumu', '', '')


-- ------------------------------------------------------- 
-- BelgelerTipiId -- bu field SrcAdayTakip tablosunda yok
-- bazı koşulları takip için var
-- ------------------------------------------------------- 
IF EXISTS (Select * From sys.objects WHERE name = 'SrcAdayTakipBelgelerTipi')
drop table [Lkp].[SrcAdayTakipBelgelerTipi]

create table [Lkp].[SrcAdayTakipBelgelerTipi]
(
   Id                Int Unique not null, 
   BelgelerTipi      nVarchar(50)   null,
   KonuGrupId        SmallInt       null,
   KonuId            Int            null,
   KonuCaption       nVarchar(20)   null,
   ChartCaption      nVarchar(20)   null,
   FormCaption       nVarchar(30)   null,
   
   constraint  pk_SrcAdayTakipBelgelerTipi primary key (Id)
)
-- ------------------------------------------------------- 
-- 1261  BelgelerGeldi         /* tamamı geldiyse */
-- 1262  BelgelerTarandi       /* tamamı tarandıysa */
-- 1263  BelgelerYuklendi      /* tamamı yüklendiyse */
-- ------------------------------------------------------- 

Delete from [Lkp].[SrcAdayTakipBelgelerTipi]
INSERT INTO [Lkp].[SrcAdayTakipBelgelerTipi] (Id, BelgelerTipi, KonuGrupId, KonuId, KonuCaption, ChartCaption, FormCaption)
 VALUES 
  ( 1,  N'Belgeleri eksik olanlar',         1, 1261, 'Belgeler',  '', '' ),
  ( 2,  N'Belgeleri taranmayan',            1, 1262, 'Belgeler',  '', '' ),
  ( 3,  N'Belgeleri Mebbise yüklenmeyen',   1, 1263, 'Belgeler',  '', 'Mebbise bağlan ...' )



-- ------------------------------------------------------- 
-- SertifikaUcretTipiId ipta
-- BorcDurumuTipiId
-- ------------------------------------------------------- 
IF EXISTS (Select * From sys.objects WHERE name = 'SrcAdayTakipBorcDurumuTipi')
drop table [Lkp].[SrcAdayTakipBorcDurumuTipi]

create table [Lkp].[SrcAdayTakipBorcDurumuTipi]
(
   Id                Int Unique not null, 
   BorcDurumuTipi    nVarchar(50)   null,
   KonuGrupId        SmallInt       null,
   KonuId            Int            null,
   KonuCaption       nVarchar(20)   null,
   ChartCaption      nVarchar(20)   null,
   FormCaption       nVarchar(30)   null,
   
   constraint  pk_SrcAdayTakipBorcDurumuTipi primary key (Id)
)

Delete from [Lkp].[SrcAdayTakipBorcDurumuTipi]
INSERT INTO [Lkp].[SrcAdayTakipBorcDurumuTipi] (Id, BorcDurumuTipi, KonuGrupId, KonuId, KonuCaption, ChartCaption, FormCaption)
 VALUES 
  ( 0,    N'Borcu yok',                 9, 9101, 'Alacaklar', '', '' ),
  ( 1,    N'Vadesi gecikmiş borcu var', 9, 9102, 'Alacaklar', '', '' ),
  ( 2,    N'Borcu var, vadesi gelmedi', 9, 9103, 'Alacaklar', '', '' )


-- --------------------------------------------------------------------------------
--
-- Teorik Ders ve e-Sınavlar
--
-- --------------------------------------------------------------------------------

-- ------------------------------------------------------- 
-- TeorikDersTipiId
-- ------------------------------------------------------- 
IF EXISTS (Select * From sys.objects WHERE name = 'SrcAdayTakipTeorikDersTipi')
drop table [Lkp].[SrcAdayTakipTeorikDersTipi]

create table [Lkp].[SrcAdayTakipTeorikDersTipi]
(
   Id               Int Unique not null, 
   TeorikDersTipi   nVarchar(50)   null,
   KonuGrupId       SmallInt       null,
   KonuId           Int            null,
   KonuCaption      nVarchar(20)   null,
   ChartCaption     nVarchar(20)   null,
   FormCaption      nVarchar(15)   null,
   
   constraint  pk_SrcAdayTakipTeorikDersTipi primary key (Id)
)

-- Bu Id prc_SrcAdayTakipTeorikDersSet taraffından set ediliyor 
Delete from [Lkp].[SrcAdayTakipTeorikDersTipi]
INSERT INTO [Lkp].[SrcAdayTakipTeorikDersTipi] (Id, TeorikDersTipi, KonuGrupId, KonuId, KonuCaption, ChartCaption, FormCaption)
 VALUES 
  ( 0,  N'Tanımsız',                                      2, 2100, 'Teorik ders', '', ''),
  ( 1,  N'Teorik ders planı yok',                         2, 2101, 'Teorik ders', '', ''),
  ( 2,  N'Teorik ders planı eksik',                       2, 2102, 'Teorik ders', '', ''),
  ( 3,  N'Teorik ders planı mevcut',                      2, 2103, 'Teorik ders', '', ''),
  ( 6,  N'Muaf',                                          2, 2106, 'Teorik ders', '', ''),
  ( 11, N'Grup başlangıç tarihi belli değil',             2, 2111, 'Teorik ders', '', ''),
  ( 12, N'Teorik dersler planlanacak',                    2, 2112, 'Teorik ders', '', ''),
  ( 13, N'Teorik dersler planlandı, Mebbise aktarılacak', 2, 2113, 'Teorik ders', '', ''),
  ( 14, N'Teorik dersler Mebbise aktarıldı',              2, 2114, 'Teorik ders', '', ''),
  ( 15, N'Teorik dersler başlamadı',                      2, 2115, 'Teorik ders', '', ''),
  ( 16, N'Teorik dersler başladı',                        2, 2116, 'Teorik ders', '', ''),
  ( 17, N'Teorik dersler tamamlandı',                     2, 2117, 'Teorik ders', '', '')


-- ------------------------------------------------------- 
-- GirecegiSinavTipiId   
-- ------------------------------------------------------- 
IF EXISTS (Select * From sys.objects WHERE name = 'SrcAdayTakipGirecegiSinavTipi')
drop table [Lkp].[SrcAdayTakipGirecegiSinavTipi]

create table [Lkp].[SrcAdayTakipGirecegiSinavTipi]
(
   Id                 Int Unique not null, 
   GirecegiSinavTipi  nVarchar(50)   null,
   KonuGrupId         SmallInt       null,
   KonuId             Int            null,
   KonuCaption        nVarchar(20)   null,
   ChartCaption       nVarchar(30)   null,
   FormCaption        nVarchar(15)   null,
   
   constraint  pk_SrcAdayTakipGirecegiSinavTipi primary key (Id)
)

Delete from [Lkp].[SrcAdayTakipGirecegiSinavTipi]
INSERT INTO [Lkp].[SrcAdayTakipGirecegiSinavTipi] (Id, GirecegiSinavTipi, KonuGrupId, KonuId, KonuCaption, ChartCaption, FormCaption)--  , ChartCaption, FormCaption)
 VALUES 
  ( 0,    N'Tanımsız',                3, 2110, 'Gireceği sınav', '', '' ),
  ( 1,    N'Teorik + Uygulama',       3, 2111, 'Gireceği sınav', '', '' ),
  ( 2,    N'Sadece Teorik',           3, 2112, 'Gireceği sınav', '', '' ),
  ( 3,    N'Sadece Uygulama',         3, 2113, 'Gireceği sınav', '', '' )


-- ------------------------------------------------------- 
-- eSinavDurumTipiId
-- ------------------------------------------------------- 
IF EXISTS (Select * From sys.objects WHERE name = 'SrcAdayTakipeSinavDurumTipi')
drop table [Lkp].[SrcAdayTakipeSinavDurumTipi]

create table [Lkp].[SrcAdayTakipeSinavDurumTipi]
(
   Id               Int Unique not null, 
   eSinavDurumTipi  nVarchar(50)   null,
   KonuGrupId       SmallInt       null,
   KonuId           Int            null,
   KonuCaption      nVarchar(20)   null,
   ChartCaption     nVarchar(30)   null,
   FormCaption      nVarchar(15)   null,
   
   constraint  pk_SrcAdayTakipeSinavDurumTipi primary key (Id)
)

Delete from [Lkp].[SrcAdayTakipeSinavDurumTipi]
INSERT INTO [Lkp].[SrcAdayTakipeSinavDurumTipi] (Id, eSinavDurumTipi, KonuGrupId, KonuId, KonuCaption, ChartCaption, FormCaption)--  , ChartCaption, FormCaption)
 VALUES 
  ( 0,    N'Tanımsız',                    3, 2120, 'Sınav durumu', '', '' ),
  ( 1,    N'Hazır değil',                 3, 2121, 'Sınav durumu', 'Hazır değil', '' ),                 -- default
  ( 2,    N'A. Sınava girecek',           3, 2122, 'Sınav durumu', 'A. Sınava girecek', '' ),    -- TeorikDersTipiId tetikleyecek
  ( 3,    N'B. Sınav ücreti bekleniyor',  3, 2123, 'Sınav durumu', 'B. Sınav ücreti bekleniyor', '' ),   
  ( 4,    N'C. Sınavı planlanacak',       3, 2124, 'Sınav durumu', 'C. Sınavı planlanack', '' ),    
  ( 5,    N'D. Sınav listesinde',         3, 2125, 'Sınav durumu', 'D. Sınav listesinde', '' ),  
  ( 6,    N'Muaf',                        3, 2126, 'Sınav durumu', '', '' )     -- şuanda kullanılmıyor fakata herhangi bir sebepten dolayı gerekebilir

-- ------------------------------------------------------- 
-- eSinavSonucTipiId
-- ------------------------------------------------------- 
IF EXISTS (Select * From sys.objects WHERE name = 'SrcAdayTakipeSinavSonucTipi')
drop table [Lkp].[SrcAdayTakipeSinavSonucTipi]

create table [Lkp].[SrcAdayTakipeSinavSonucTipi]
(
   Id               Int Unique not null, 
   eSinavSonucTipi  nVarchar(50)   null,
   KonuGrupId       SmallInt       null,
   KonuId           Int            null,
   KonuCaption      nVarchar(20)   null,
   ChartCaption     nVarchar(20)   null,
   FormCaption      nVarchar(15)   null,
   
   constraint  pk_SrcAdayTakipeSinavSonucTipi primary key (Id)
)

Delete from [Lkp].[SrcAdayTakipeSinavSonucTipi]
INSERT INTO [Lkp].[SrcAdayTakipeSinavSonucTipi] (Id, eSinavSonucTipi, KonuGrupId, KonuId, KonuCaption, ChartCaption, FormCaption) --, ChartCaption, FormCaption)
 VALUES 
  ( 0,    N'Tanımsız',                    3, 2130, 'Sınav sonucu', '', '' ),
  ( 1,    N'Başarılı',                    3, 2131, 'Sınav sonucu', 'Başarılı', ''),
  ( 2,    N'Başarısız',                   3, 2132, 'Sınav sonucu', 'Başarısız', ''),
  ( 3,    N'Girmedi',                     3, 2133, 'Sınav sonucu', 'Girmedi', ''),
  ( 4,    N'Raporlu',                     3, 2134, 'Sınav sonucu', 'Raporlu', ''),
  ( 5,    N'İptal Edildi(Sınav Yasaklı)', 3, 2135, 'Sınav sonucu', 'İptal', '')

-- ------------------------------------------------------- 
-- eSinavSonrasiTipiId
-- ------------------------------------------------------- 
IF EXISTS (Select * From sys.objects WHERE name = 'SrcAdayTakipeSinavSonrasiTipi')
drop table [Lkp].[SrcAdayTakipeSinavSonrasiTipi]

create table [Lkp].[SrcAdayTakipeSinavSonrasiTipi]
(
   Id                 Int Unique not null, 
   eSinavSonrasiTipi  nVarchar(50)   null,
   KonuGrupId         SmallInt       null,
   KonuId             Int            null,
   KonuCaption        nVarchar(20)   null,
   ChartCaption       nVarchar(20)   null,
   FormCaption        nVarchar(15)   null,   

   constraint  pk_SrcAdayTakipeSinavSonrasıTipi primary key (Id)
)

Delete from [Lkp].[SrcAdayTakipeSinavSonrasiTipi]
INSERT INTO [Lkp].[SrcAdayTakipeSinavSonrasiTipi] (Id, eSinavSonrasiTipi, KonuGrupId, KonuId, KonuCaption, ChartCaption, FormCaption) --, ChartCaption, FormCaption)
 VALUES 
  ( 0,    N'Tanımsız',                      3, 2140, 'Sınav sonrası', '', '' ),
  ( 1,    N'Tekrar sınava girecek',         3, 2141, 'Sınav sonrası', 'Tekrar sınav', '' ),
  ( 2,    N'Uygulama aşamasına geçti',      3, 2142, 'Sınav sonrası', 'Uyg. aşama. geçti', '' ),
  ( 3,    N'Tüm teorik sınav hakkı bitti',  3, 2143, 'Sınav sonrası', 'Sınav hakkı bitti', '' )

-- ------------------------------------------------------- 
-- eSinavUcretTipiId
-- ------------------------------------------------------- 
IF EXISTS (Select * From sys.objects WHERE name = 'SrcAdayTakipeSinavUcretTipi')
drop table [Lkp].[SrcAdayTakipeSinavUcretTipi]

create table [Lkp].[SrcAdayTakipeSinavUcretTipi]
(
   Id               Int Unique not null, 
   eSinavUcretTipi  nVarchar(50)   null,
   KonuGrupId       SmallInt       null,
   KonuId           Int            null,
   KonuCaption      nVarchar(20)   null,
   ChartCaption     nVarchar(20)   null,
   FormCaption      nVarchar(15)   null,   
   
   constraint  pk_SrcAdayTakipeSinavUcretTipi primary key (Id)
)

Delete from [Lkp].[SrcAdayTakipeSinavUcretTipi]
INSERT INTO [Lkp].[SrcAdayTakipeSinavUcretTipi] (Id, eSinavUcretTipi, KonuGrupId, KonuId, KonuCaption, ChartCaption, FormCaption)
 VALUES 
  ( 0,    N'Tanımsız',                 3, 2150, 'Sınav ücreti', '', ''),
  ( 1,    N'Biz yatıracağız',          3, 2151, 'Sınav ücreti', '', ''),
  ( 2,    N'Adayın kendisi yatıracak', 3, 2152, 'Sınav ücreti', '', '')


-- --------------------------------------------------------------------------------
--
-- Uygulamalı Dersler ve Uygulamalı Sınavlar
--
-- --------------------------------------------------------------------------------

-- ------------------------------------------------------- 
-- uSinavDurumTipiId
-- ------------------------------------------------------- 
IF EXISTS (Select * From sys.objects WHERE name = 'SrcAdayTakipuSinavDurumTipi')
drop table [Lkp].[SrcAdayTakipuSinavDurumTipi]

create table [Lkp].[SrcAdayTakipuSinavDurumTipi]
(
   Id               Int Unique not null, 
   uSinavDurumTipi  nVarchar(60)   null,
   KonuGrupId       SmallInt       null,
   KonuId           Int            null,
   KonuCaption      nVarchar(20)   null,
   ChartCaption     nVarchar(25)   null,
   FormCaption      nVarchar(15)   null,   
      
   constraint  pk_SrcAdayTakipuSinavDurumTipi primary key (Id)
)

Delete from [Lkp].[SrcAdayTakipuSinavDurumTipi]
INSERT INTO [Lkp].[SrcAdayTakipuSinavDurumTipi] (Id, uSinavDurumTipi, KonuGrupId, KonuId, KonuCaption, ChartCaption, FormCaption)
 VALUES 
  ( 0,    N'Tanımsız',                                       5, 5140, 'Sınav durumu', '', '' ), -- 3140 idi
  ( 1,    N'Henüz sınav aşamasında değil',                   5, 5141, 'Sınav durumu', '', '' ),
  ( 2,    N'Sınav aşamasında',                               5, 5142, 'Sınav durumu', '', '' ),    -- TeorikDersTipiId tetikleyecek
  ( 6,    N'Muaf',                                           5, 5146, 'Sınav durumu', '', '' ), -- neden ve nasıl muaf bilmiyorum
  ( 7,    N'Girmedi, sınav hakkı yandı, sınava girecek',     5, 5147, 'Sınav durumu', '', '' ),
  ( 8,    N'Başarısız, tekrar sınava girecek',               5, 5148, 'Sınav durumu', '', '' ),
  ( 9,    N'Başarılı, Sertifika aşamasına geçti',            5, 5149, 'Sınav durumu', '', '' ),
  (10,    N'Uyg. sınav hakkı doldu',                         5, 5150, 'Sınav durumu', '', '' )


-- ------------------------------------------------------- 
-- uSinavSonucTipiId
-- ------------------------------------------------------- 
IF EXISTS (Select * From sys.objects WHERE name = 'SrcAdayTakipuSinavSonucTipi')
drop table [Lkp].[SrcAdayTakipuSinavSonucTipi]

create table [Lkp].[SrcAdayTakipuSinavSonucTipi]
(
   Id               Int Unique not null, 
   uSinavSonucTipi  nVarchar(50)   null,
   KonuGrupId       SmallInt       null,
   KonuId           Int            null,
   KonuCaption      nVarchar(20)   null,
   ChartCaption     nVarchar(20)   null,
   FormCaption      nVarchar(15)   null,   
   
   constraint  pk_SrcAdayTakipuSinavSonucTipi primary key (Id)
)

Delete from [Lkp].[SrcAdayTakipuSinavSonucTipi]
INSERT INTO [Lkp].[SrcAdayTakipuSinavSonucTipi] (Id, uSinavSonucTipi, KonuGrupId, KonuId, KonuCaption, ChartCaption, FormCaption)
 VALUES 
  ( 0,    N'Tanımsız',  5, 5160, 'Sınav sonucu', '' ,'' ), -- 3160
  ( 1,    N'Başarılı',  5, 5161, 'Sınav sonucu', 'Başarılı' ,'' ),
  ( 2,    N'Başarısız', 5, 5162, 'Sınav sonucu', 'Başarısız' ,'' ),
  ( 3,    N'Girmedi',   5, 5163, 'Sınav sonucu', 'Girmedi' ,'' )
  
-- ------------------------------------------------------- 
-- uSinavSonrasiTipiId
-- ------------------------------------------------------- 
IF EXISTS (Select * From sys.objects WHERE name = 'SrcAdayTakipuSinavSonrasiTipi')
drop table [Lkp].[SrcAdayTakipuSinavSonrasiTipi]

create table [Lkp].[SrcAdayTakipuSinavSonrasiTipi]
(
   Id                 Int Unique not null, 
   uSinavSonrasiTipi  nVarchar(100)  null,
   KonuGrupId         SmallInt       null,
   KonuId             Int            null,
   KonuCaption        nVarchar(20)   null,
   ChartCaption       nVarchar(20)   null,
   FormCaption        nVarchar(15)   null, 
   
   constraint  pk_SrcAdayTakipuSinavSonrasıTipi primary key (Id)
)

Delete from [Lkp].[SrcAdayTakipuSinavSonrasiTipi]
INSERT INTO [Lkp].[SrcAdayTakipuSinavSonrasiTipi] (Id, uSinavSonrasiTipi, KonuGrupId, KonuId, KonuCaption, ChartCaption, FormCaption)
 VALUES 
  ( 0,    N'Tanımsız',                            5, 5170, 'Sınav sonrası', '', '' ), -- 3170 idi
  ( 1,    N'Sınava tekrar girecek',               5, 5171, 'Sınav sonrası', 'Tekrar girecek', '' ),
  ( 2,    N'Sertifika aşamasına geçti',           5, 5172, 'Sınav sonrası', 'Sertifikayı kazandı', '' ),
  ( 3,    N'Tüm uygulamalı sınav hakkı bitti',    5, 5173, 'Sınav sonrası', 'Sınav hakkı bitti', '' ),
  --( 4,    N'2. +4 sınav hakkı bitti',             5, 5174, 'Sınav sonrası', '2.+4 sınav hak bitti', '' ),
  ( 5,    N'Sınava giren toplam kursiyer sayısı', 5, 5175, 'Sınav sonrası', 'Toplam kursiyer', '' )


-- ------------------------------------------------------- 
-- uSinavUcretTipiId
-- ------------------------------------------------------- 
IF EXISTS (Select * From sys.objects WHERE name = 'SrcAdayTakipuSinavUcretTipi')
drop table [Lkp].[SrcAdayTakipuSinavUcretTipi]

create table [Lkp].[SrcAdayTakipuSinavUcretTipi]
(
   Id               Int Unique not null, 
   uSinavUcretTipi  nVarchar(50)   null,
   KonuGrupId       SmallInt       null,
   KonuId           Int            null,
   KonuCaption      nVarchar(20)   null,
   ChartCaption     nVarchar(20)   null,
   FormCaption      nVarchar(15)   null, 
   
   constraint  pk_SrcAdayTakipuSinavUcretTipi primary key (Id)
)

Delete from [Lkp].[SrcAdayTakipuSinavUcretTipi]
INSERT INTO [Lkp].[SrcAdayTakipuSinavUcretTipi] (Id, uSinavUcretTipi, KonuGrupId, KonuId, KonuCaption, ChartCaption, FormCaption)
 VALUES 
  ( 0,    N'Tanımsız',                 5, 5180, 'Sınav ücreti', '', '' ), -- 3180 idi
  ( 1,    N'Biz yatıracağız',          5, 5181, 'Sınav ücreti', '', '' ),
  ( 2,    N'Adayın kendisi yatıracak', 5, 5182, 'Sınav ücreti', '', '' )


-- ------------------------------------------------------- 
--
-- SertifikaDurumTipiId
--
-- ------------------------------------------------------- 


IF EXISTS (Select * From sys.objects WHERE name = 'SrcAdayTakipSertifikaDurumTipi')
drop table [Lkp].[SrcAdayTakipSertifikaDurumTipi]

create table [Lkp].[SrcAdayTakipSertifikaDurumTipi]
(
   Id                 Int Unique not null, 
   SertifikaDurumTipi nVarchar(50)   null,
   KonuGrupId         SmallInt       null,
   KonuId             Int            null,
   KonuCaption        nVarchar(20)   null,
   ChartCaption       nVarchar(20)   null,
   FormCaption        nVarchar(15)   null,
   
   constraint  pk_SrcAdayTakipSertifikaDurumTipi primary key (Id)
)

Delete from [Lkp].[SrcAdayTakipSertifikaDurumTipi]
INSERT INTO [Lkp].[SrcAdayTakipSertifikaDurumTipi] (Id, SertifikaDurumTipi, KonuGrupId, KonuId, KonuCaption, ChartCaption, FormCaption)
 VALUES 
  ( 0,    N'Tanımsız',                                     6, 6110, 'Sertifika işlemleri',  '', '' ),  --- 4110
  ( 1,    N'Sertifikası hazırlanacak (Seri No verilecek)', 6, 6111, 'Sertifika işlemleri', 'Sert. hazırlanacak', '' ),
  ( 2,    N'Sertifika formu yazdırılacak',                 6, 6112, 'Sertifika işlemleri', 'Sert. formu yaz', '' ),
  ( 3,    N'Sertifikası hazır',                            6, 6113, 'Sertifika işlemleri', 'Sert. hazır', '' ),
  ( 4,    N'Sertifikası teslim edildi',                    6, 6114, 'Sertifika işlemleri', 'Sert. teslim edildi', '' )





-- ------------------------------------------------------- 
--
-- Asama1TipiId
--
-- ------------------------------------------------------- 


IF EXISTS (Select * From sys.objects WHERE name = 'SrcAdayTakipAsama1Tipi')
drop table [Lkp].[SrcAdayTakipAsama1Tipi]

create table [Lkp].[SrcAdayTakipAsama1Tipi]
(
   Id                 Int Unique not null, 
   Asama1Tipi         nVarchar(50)   null,
   KonuGrupId         SmallInt       null,
   KonuId             Int            null,
   KonuCaption        nVarchar(20)   null,
   ChartCaption       nVarchar(20)   null,
   FormCaption        nVarchar(15)   null,
   
   constraint  pk_SrcAdayTakipAsama1Tipi primary key (Id)
)

Delete from [Lkp].[SrcAdayTakipAsama1Tipi]
INSERT INTO [Lkp].[SrcAdayTakipAsama1Tipi] (Id, Asama1Tipi, KonuGrupId, KonuId, KonuCaption, ChartCaption, FormCaption)
 VALUES 
  (   0,    N'',                                     9, 9000, 'Aşama işlemleri',  '', '' ), 
  ( 100,    N'Kayıt aşaması',                        9, 9100, 'Aşama işlemleri',  '', '' ), 
  ( 200,    N'Teorik ders aşaması',                  9, 9200, 'Aşama işlemleri',  '', '' ), 
  ( 300,    N'Teorik sınav durum aşaması',           9, 9300, 'Aşama işlemleri',  '', '' ), 
  ( 400,    N'Teorik sınav sonrası aşaması',              9, 9400, 'Aşama işlemleri',  '', '' ), 
  --( 510,    N'Uygulamalı dersler aşaması',           9, 9510, 'Aşama işlemleri',  '', '' ), 
  --( 520,    N'Telafi dersler aşaması',               9, 9520, 'Aşama işlemleri',  '', '' ), 
  --( 530,    N'2. +4 hak dersleri aşaması',           9, 9530, 'Aşama işlemleri',  '', '' ), 
  --( 540,    N'Başarısız dersler aşaması',            9, 9540, 'Aşama işlemleri',  '', '' ), 
  ( 600,    N'Uygulamalı sınav aşaması',             9, 9600, 'Aşama işlemleri',  '', '' ), 
  ( 700,    N'Uygulamalı sınav sonrası aşaması',     9, 9700, 'Aşama işlemleri',  '', '' ), 
  ( 810,    N'Sertifika alanlar',                    9, 9810, 'Aşama işlemleri',  '', '' ), 
  ( 820,    N'Dosya yakanlar',                       9, 9820, 'Aşama işlemleri',  '', '' ), 
  ( 830,    N'Arşiv',                                9, 9830, 'Aşama işlemleri',  '', '' ) 


-- ------------------------------------------------------- 
--
-- Asama2TipiId
--
-- ------------------------------------------------------- 


IF EXISTS (Select * From sys.objects WHERE name = 'SrcAdayTakipAsama2Tipi')
drop table [Lkp].[SrcAdayTakipAsama2Tipi]

create table [Lkp].[SrcAdayTakipAsama2Tipi]
(
   Id                 Int Unique not null, 
   Asama2Tipi         nVarchar(50)   null,
   KonuGrupId         SmallInt       null,
   KonuId             Int            null,
   KonuCaption        nVarchar(20)   null,
   ChartCaption       nVarchar(20)   null,
   FormCaption        nVarchar(15)   null,
   
   constraint  pk_SrcAdayTakipAsama2Tipi primary key (Id)
)

Delete from [Lkp].[SrcAdayTakipAsama2Tipi]
INSERT INTO [Lkp].[SrcAdayTakipAsama2Tipi] (Id, Asama2Tipi, KonuGrupId, KonuId, KonuCaption, ChartCaption, FormCaption)
 VALUES 
  (   0,    N'',                                     9, 9000, 'Aşama işlemleri',  '', '' ), 
  ( 100,    N'Kayıt aşaması',                        9, 9100, 'Aşama işlemleri',  '', '' ), 
  ( 200,    N'Teorik ders aşaması',                  9, 9200, 'Aşama işlemleri',  '', '' ), 
  ( 300,    N'Teorik sınav durum aşaması',           9, 9300, 'Aşama işlemleri',  '', '' ), 
  ( 400,    N'Teorik sınav sonrası aşaması',         9, 9400, 'Aşama işlemleri',  '', '' ), 
  --( 510,    N'Uygulamalı dersler aşaması',           9, 9510, 'Aşama işlemleri',  '', '' ), 
  --( 520,    N'Telafi dersler aşaması',               9, 9520, 'Aşama işlemleri',  '', '' ), 
  --( 530,    N'2. +4 hak dersleri aşaması',           9, 9530, 'Aşama işlemleri',  '', '' ), 
  --( 540,    N'Başarısız dersler aşaması',            9, 9540, 'Aşama işlemleri',  '', '' ), 
  ( 600,    N'Uygulamalı sınav aşaması',             9, 9600, 'Aşama işlemleri',  '', '' ), 
  ( 700,    N'Uygulamalı sınav sonrası aşaması',     9, 9700, 'Aşama işlemleri',  '', '' ), 
  ( 810,    N'Sertifika alanlar',                    9, 9810, 'Aşama işlemleri',  '', '' ), 
  ( 820,    N'Dosya yakanlar',                       9, 9820, 'Aşama işlemleri',  '', '' ), 
  ( 830,    N'Arşiv',                                9, 9830, 'Aşama işlemleri',  '', '' ) 


-- ------------------------------------------------------- 
--
-- Asama1DetayTipiId
--
-- ------------------------------------------------------- 


IF EXISTS (Select * From sys.objects WHERE name = 'SrcAdayTakipAsama1DetayTipi')
drop table [Lkp].[SrcAdayTakipAsama1DetayTipi]

create table [Lkp].[SrcAdayTakipAsama1DetayTipi]
(
   Id                 Int Unique not null, 
   Asama1DetayTipi    nVarchar(60)   null,
   KonuGrupId         SmallInt       null,
   KonuId             Int            null,
   KonuCaption        nVarchar(20)   null,
   ChartCaption       nVarchar(20)   null,
   FormCaption        nVarchar(15)   null,
   
   constraint  pk_SrcAdayTakipAsama1DetayTipi primary key (Id)
)

Delete from [Lkp].[SrcAdayTakipAsama1DetayTipi]
INSERT INTO [Lkp].[SrcAdayTakipAsama1DetayTipi] (Id, Asama1DetayTipi, KonuGrupId, KonuId, KonuCaption, ChartCaption, FormCaption)
 VALUES 
  ( 100,    N'',                            9, 9100, 'Aşama işlemleri',  '', '' ), 
  ( 101,    N'Belgeleri eksik',             9, 9101, 'Aşama detayları',  '', '' ), 
  ( 102,    N'Belgeleri taranacak',         9, 9102, 'Aşama detayları',  '', '' ), 
  ( 103,    N'Belgeleri yüklenecek',        9, 9103, 'Aşama detayları',  '', '' ), 
  ( 104,    N'Belge işlemleri tamamlandı',  9, 9104, 'Aşama detayları',  '', '' ), 

  ( 215,    N'Teorik dersler başlamadı',    9, 9215, 'Aşama detayları',  '', '' ), 
  ( 216,    N'Teorik dersler başladı',      9, 9216, 'Aşama detayları',  '', '' ), 
  ( 217,    N'Teorik dersler tamamlandı',   9, 9217, 'Aşama detayları',  '', '' ), 

  ( 300,    N'',                             9, 9300, 'Aşama detayları',  '', '' ), 
  ( 301,    N'Hazır değil',                  9, 9301, 'Aşama detayları',  '', '' ), 
  ( 302,    N'Başvuru yapılacak',            9, 9302, 'Aşama detayları',  '', '' ), 
  ( 303,    N'Belgesi hazırlanacak',         9, 9303, 'Aşama detayları',  '', '' ), 
  ( 304,    N'Belgesi teslim edilecek',      9, 9304, 'Aşama detayları',  '', '' ), 
  ( 305,    N'Sınava girecek',               9, 9305, 'Aşama detayları',  '', '' ), 
  ( 306,    N'Muaf',                         9, 9306, 'Aşama detayları',  '', '' ), 

  ( 600,    N'',                                               9, 9600, 'Aşama detayları',  '', '' ), 
  ( 601,    N'Henüz sınav aşamasında değil',                   9, 9601, 'Aşama detayları',  '', '' ), 
  --( 602,    N'Uyg. sınavı için usta öğretici onayı isteniyor', 9, 9602, 'Aşama detayları',  '', '' ), 
  --( 603,    N'Uyg. sınavı için hazır değil',                   9, 9603, 'Aşama detayları',  '', '' ), 
  --( 604,    N'Uyg. sınavı için MEBBİS de onaylanacak',         9, 9604, 'Aşama detayları',  '', '' ), 
  --( 605,    N'Uyg. sınav randevusu planlanacak',               9, 9605, 'Aşama detayları',  '', '' ), 
  --( 606,    N'Uyg. sınav randevusu MEBBİSe aktarılacak',       9, 9606, 'Aşama detayları',  '', '' ), 
  ( 607,    N'Uyg. sınavına girecek',                          9, 9607, 'Aşama detayları',  '', '' ), 
  --( 608,    N'Başarısız aday eğitimi alacak',                  9, 9608, 'Aşama detayları',  '', '' ), 
  --( 609,    N'Başarılı, Sertifika aşamasına geçti',            9, 9609, 'Aşama detayları',  '', '' ), 
  ( 610,    N'Uyg. sınav hakkı doldu',                         9, 9610, 'Aşama detayları',  '', '' ) 



-- ------------------------------------------------------- 
--
-- Asama2DetayTipiId
--
-- ------------------------------------------------------- 


IF EXISTS (Select * From sys.objects WHERE name = 'SrcAdayTakipAsama2DetayTipi')
drop table [Lkp].[SrcAdayTakipAsama2DetayTipi]

create table [Lkp].[SrcAdayTakipAsama2DetayTipi]
(
   Id                 Int Unique not null, 
   Asama2DetayTipi    nVarchar(60)   null,
   KonuGrupId         SmallInt       null,
   KonuId             Int            null,
   KonuCaption        nVarchar(20)   null,
   ChartCaption       nVarchar(20)   null,
   FormCaption        nVarchar(15)   null,
   
   constraint  pk_SrcAdayTakipAsama2DetayTipi primary key (Id)
)

Delete from [Lkp].[SrcAdayTakipAsama2DetayTipi]
INSERT INTO [Lkp].[SrcAdayTakipAsama2DetayTipi] (Id, Asama2DetayTipi, KonuGrupId, KonuId, KonuCaption, ChartCaption, FormCaption)
 VALUES 
  ( 400,    N'',                             9, 9400, 'Aşama detayları',  '', '' ), 
  ( 401,    N'Tekrar sınava girecek',        9, 9401, 'Aşama detayları',  '', '' ), 
  ( 402,    N'Uygulama aşamasına geçti',     9, 9402, 'Aşama detayları',  '', '' ), 
  ( 403,    N'Tüm teorik sınav hakkı bitti', 9, 9403, 'Aşama detayları',  '', '' ), 

  ( 700,    N'',                                 9, 9700, 'Aşama detayları',  '', '' ), 
  ( 701,    N'Sınava tekrar girecek',            9, 9701, 'Aşama detayları',  '', '' ), 
  ( 702,    N'Sertifika aşamasına geçti',        9, 9702, 'Aşama detayları',  '', '' ), 
  ( 703,    N'Tüm uygulamalı sınav hakkı bitti', 9, 9703, 'Aşama detayları',  '', '' ) 
  --( 704,    N'2. +4 sınav hakkı bitti',          9, 9704, 'Aşama detayları',  '', '' ) 


commit transaction



/*CreateLkpTableEnd*/



/*CreateTrigger*/

CREATE TRIGGER [dbo].[trg_SrcAdayTakip] on [dbo].[SrcAdayTakip]
AFTER INSERT, UPDATE
AS BEGIN

    DECLARE takipCursor cursor local for select Id from Inserted
    DECLARE @takipId bigint

    OPEN takipCursor
    FETCH NEXT FROM takipCursor INTO @takipId

    -- Veri Transferi başladımı
    declare @DbUpdatesIsActive Bit = 0
    set @DbUpdatesIsActive = [dbo].[fnc_getIsDbUpdate] (13)

    declare @TalepId int = 0
	declare @AdayId int
    declare @FirmId int
	
    declare @eIseSinavaGirebilir bit
    declare @eIsuSinavaGirebilir bit
    declare @yIseSinavaGirebilir bit
    declare @yIsuSinavaGirebilir bit

    WHILE @@FETCH_STATUS = 0
    BEGIN
        if (@DbUpdatesIsActive = 0)
        begin 
            select 
                @eIseSinavaGirebilir = isnull(dlt.IseSinavaGirebilir,0)
               ,@eIsuSinavaGirebilir = isnull(dlt.IsuSinavaGirebilir,0)
            from deleted dlt
            where dlt.Id = @takipId
			
            select 
                @FirmId  = ins.FirmId
               ,@TalepId = ins.TalepId
               ,@AdayId = ins.AdayId
               ,@yIseSinavaGirebilir = isnull(ins.IseSinavaGirebilir,0)
               ,@yIsuSinavaGirebilir = isnull(ins.IsuSinavaGirebilir,0)
            from inserted ins
            where ins.Id = @takipId

            if (@eIseSinavaGirebilir <> @yIseSinavaGirebilir 
            or  @eIsuSinavaGirebilir <> @yIsuSinavaGirebilir)
            begin 
                Execute dbo.prc_SrcAdayTakip @FirmId, @TalepId, 0, 'SrcAdayTakipESinav'
			end

        end	-- 	@DbUpdatesIsActive = 0
		
        FETCH NEXT FROM takipCursor INTO @takipId
    END -- While

    CLOSE takipCursor
    DEALLOCATE takipCursor   


END -- create trigger



/*CreateTriggerEnd*/


