/*CreateProcedure*/

CREATE PROCEDURE [dbo].[prc_SrcAdayTablesInsert] (@TalepId int)  
AS BEGIN

  declare @yFirmId int = 0
  declare @yAdayId int = 0 
  declare @yTalepTipiId smallInt = 0
  declare @yDonemTipiId int = 0
  declare @yGrupTipiId smallInt = 0
  declare @ySubeTipiId smallInt = 0
  declare @yTcNo varchar(11) = ''

  declare @onayBelgeler bit = 0
  declare @onayAdliSicil bit = 0
  declare @onayAdres bit = 0
  declare @onayEhliyet bit = 0
  --declare @onayImza bit = 0
  declare @onayOgrenim bit = 0
  --declare @onaySaglik bit = 0
  --declare @onaySertifika bit = 0
  --declare @onaySozlesme bit = 0
  
  Select 
       @yFirmId = ins.FirmId
      ,@yAdayId = isnull(ins.AdayId, 0) 
      ,@yTcNo = isnull(ins.TcNo,'')
      ,@yTalepTipiId = isnull(ins.TalepTipiId, 0)
      ,@yDonemTipiId = isnull(ins.DonemTipiId,0)
      ,@yGrupTipiId = isnull(ins.GrupTipiId,0)
      ,@ySubeTipiId = isnull(ins.SubeTipiId,0)
  From SrcAdayTalep as ins
  Where ins.Id = @TalepId
     
  if (@yTalepTipiId = 1) or  -- src1234
     (@yTalepTipiId = 2) or  -- src5
     --(@yTalepTipiId = 3) or  -- src6
     (@yTalepTipiId = 4) or  -- Ody1234
     (@yTalepTipiId = 5)     -- Udy1234
  begin
      set @onayBelgeler = 1
      set @onayAdliSicil = 1
      set @onayAdres = 1
      set @onayEhliyet = 1
      --set @onayImza = 0
      set @onayOgrenim = 1
      --set @onaySaglik = 0
      --set @onaySertifika = 0
      --set @onaySozlesme = 0
  end 
  
  
  -- SrcAdayBelgeler Insert
  if ( Select count(*) ADET from dbo.SrcAdayBelgeler 
       where TalepId = @TalepId 
     ) = 0 and (@onayBelgeler = 1)
  begin 
       insert into dbo.SrcAdayBelgeler (
              FirmId , TalepId , AdayId , TcNo , DonemTipiId 
            , BiyometrikTarandi  , BasvuruFotoTarandi  , OgrenimTarandi  , SaglikTarandi  , AdliSicilTarandi  , ImzaTarandi  , Sozlesme1Tarandi  , Sozlesme2Tarandi  , AdresKodlandi , BelgelerTarandi  , AdayKaydiYapildi 
            , BiyometrikYuklendi , BasvuruFotoYuklendi , OgrenimYuklendi , SaglikYuklendi , AdliSicilYuklendi , ImzaYuklendi , Sozlesme1Yuklendi , Sozlesme2Yuklendi , AdresYuklendi , BelgelerYuklendi 
            , IsSertifikaUcreti  , SertifikaUcretiIsPaid , IsUcretsiz , IsFatura 
            , Kimlik1Tarandi     , Kimlik2Tarandi
            , Ehliyet1Tarandi    , Ehliyet2Tarandi
            ) values
            ( @yFirmId, @TalepId, @yAdayId, @yTcNo,  @yDonemTipiId,
                0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
                0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
                0,  0,  0,  0, 
                0,  0,  0,  0
                ) 
       print ' create : [SrcAdayBelgeler]'
  end -- SrcAdayBelgeler
        
  -- SrcAdayAdliSicil Insert
  if ( Select count(*) ADET from dbo.SrcAdayAdliSicil
       where TalepId = @TalepId 
     ) = 0 and (@onayAdliSicil = 1)
  begin 
       Insert into [dbo].[SrcAdayAdliSicil]
           (FirmId, TalepId, AdayId) VALUES (@yFirmId, @TalepId, @yAdayId ) 
       print ' create : [SrcAdayAdliSicil]'
  end

  -- SrcAdayAdres Insert
  if ( Select count(*) ADET from dbo.SrcAdayAdres
       where TalepId = @TalepId 
     ) = 0 and (@onayAdres = 1) 
  begin 
       Insert into [dbo].[SrcAdayAdres]
            (FirmId, TalepId, AdayId) VALUES (@yFirmId, @TalepId, @yAdayId )  
       print ' create : [SrcAdayAdres]'
  end

  -- SrcAdayImza Insert
  /*
  if ( Select count(*) ADET from dbo.SrcAdayImza
       where TalepId = @TalepId 
     ) = 0 and (@onayImza = 1) 
  begin 
       Insert into [dbo].[SrcAdayImza]
            (FirmId, TalepId, AdayId) VALUES (@yFirmId, @TalepId, @yAdayId ) 
       print ' create : [SrcAdayImza]'
  end
  */
  -- SrcAdayOgrenim Insert
  if ( Select count(*) ADET from dbo.SrcAdayOgrenim
       where TalepId = @TalepId 
     ) = 0 and (@onayOgrenim = 1) 
  begin 
       Insert into [dbo].[SrcAdayOgrenim]
            (FirmId, TalepId, AdayId) VALUES (@yFirmId, @TalepId, @yAdayId )   
       print ' create : [SrcAdayOgrenim]'
  end

  -- SrcAdaySaglik Insert
  /*
  if ( Select count(*) ADET from dbo.SrcAdaySaglik
       where TalepId = @TalepId 
     ) = 0 and (@onaySaglik = 1) 
  begin 
       Insert into [dbo].[SrcAdaySaglik]
            (FirmId, TalepId, AdayId) VALUES (@yFirmId, @TalepId, @yAdayId )   
       print ' create : [SrcAdaySaglik]'
  end
  */

  -- SrcAdaySertifika Insert
  /*
  if ( Select count(*) ADET from dbo.SrcAdaySertifika
       where TalepId = @TalepId 
     ) = 0 and (@onaySertifika = 1) 
  begin 
       Insert into [dbo].[SrcAdaySertifika]
            (FirmId, TalepId, AdayId) VALUES (@yFirmId, @TalepId, @yAdayId ) 
       print ' create : [SrcAdaySertifika]'
  end
  */

  -- SrcAdaySozlesme Insert
  /*
  if ( Select count(*) ADET from [dbo].[SrcAdaySozlesme]
       where TalepId = @TalepId 
     ) = 0 and (@onaySozlesme = 1) 
  begin 
       Insert into [dbo].[SrcAdaySozlesme]
            ([FirmId],[TalepId],[AdayId]) VALUES (@yFirmId, @TalepId, @yAdayId) 
       print ' create : [SrcAdaySozlesme]'
  end
  */

  -- SrcAdayKimlik Insert
  if ( Select count(*) ADET from [dbo].[SrcAdayKimlik]
       where AdayId = @yAdayId 
     ) = 0 
  begin 
      Insert into [dbo].[SrcAdayKimlik]
           ([FirmId],[TalepId],[AdayId],[TcNo],[VeriKaynakId],[IsEhliyetli],[Kimlik1Resim],[Kimlik2Resim],[Kimlik1ResimSmall],[Kimlik2ResimSmall]) 
           Values 
           (@yFirmId
           ,0 -- TalepId : bu kayıt talebe bağlı değil, SrcAday tablosuna bağlıdır
           ,@yAdayId
           ,@yTcNo
           ,null --VeriKaynakId
           ,0 --IsEhliyetli
           ,null, null, null, null ) -- Kimlik1Resim, Kimlik2Resim, Kimlik1ResimSmall, Kimlik2ResimSmall
  end -- if

  -- SrcAdayEhliyet Insert
  if ( Select count(*) ADET from [dbo].[SrcAdayEhliyet]
       where AdayId = @yAdayId 
     ) = 0 
  begin 
      Insert into [dbo].[SrcAdayEhliyet]
           ([FirmId],[TalepId],[AdayId],[TcNo],[VeriKaynakId],
            [MevcutEhliyetTipiId],[MevcutEhliyetVerilisTarihi],[MevcutEhlSonGecerlilikTarihi],[MevcutEhliyetNo],[MevcutEhliyetVerildigiIl],[IsMevcutEhlOtomatik],[IsMevcutEhl2016Oncesi]
           ,[Ehliyet1Resim],[Ehliyet2Resim],[Ehliyet1ResimSmall],[Ehliyet2ResimSmall])
           Values
           (@yFirmId
           ,0 -- TalepId : bu kayıt talebe bağlı değil, SrcAday tablosuna bağlıdır
           ,@yAdayId
           ,@yTcNo
           ,null --VeriKaynakId
           ,0, null, null, '', '', 0, 0 --MevcutEhliyetTipiId, MevcutEhliyetVerilisTarihi, MevcutEhlSonGecerlilikTarihi, MevcutEhliyetNo, MevcutEhliyetVerildigiIl, IsMevcutEhlOtomatik, IsMevcutEhl2016Oncesi,
           ,null, null, null, null ) -- Ehliyet1Resim, Ehliyet2Resim, Ehliyet1ResimSmall, Ehliyet2ResimSmall
  end -- 

  -- SrcAdayUcret Insert
  if ( Select count(*) ADET from [dbo].[SrcAdayUcret]
       where TalepId = @TalepId 
     ) = 0 
  begin 
       Insert into  dbo.SrcAdayUcret
           ( FirmId, TalepId, AdayId, DonemTipiId, TalepTipiId
           , IsUcretli, IsUcretsiz, IsLock, IsOwes
           , SertifikaUcreti
           , BirSaatOzelDersUcreti, AlacagiOzelDersSayisi
           , KontejanTipiId, KontejanIndirimOrani, KontejanIndirimTutari, KontejanSonrasiUcret
           , AnlasilanUcret, IskontoOrani, IskontoTutari, PesinatTutari
           , TaksitSayisiTipiId, TaksitlendirilecekUcret
           , ESinavUcreti, UygulamaSinavUcreti
           , SertifikaVeSinavUcreti, IsSinavUcretiTaksitli
           , OdemeTipiId, OdemeBaslamaTarihi, OdemeCepTelefonu, ESinavUcretTipiId, USinavUcretTipiId
           , MebbisSertifikaUcreti, MebbisTeoDersSaati, Mebbis1SaatTeoDersUcreti, MebbisUygDersSaati, Mebbis1SaatUygDersUcreti
           , AlacakSertifikaUcreti, AlacakESinavUcreti, AlacakUygulamaSinavUcreti, AlacakTelafiEgitimUcreti, AlacakBasarisizEgitimUcreti, AlacakUygBasarisizUcreti, AlacakDigerUcretler, AlacakUcretlerToplami
           , BorcSertifikaUcreti, BorcESinavUcreti, BorcUygulamaSinavUcreti, BorcTelafiEgitimUcreti, BorcBasarisizEgitimUcreti, BorcUygBasarisizUcreti, BorcDigerUcretler, BorcUcretlerToplami
           , VGSertifikaUcreti, VGESinavUcreti, VGUygulamaSinavUcreti, VGTelafiEgitimUcreti, VGBasarisizEgitimUcreti, VGUygBasarisizUcreti, VGDigerUcretler, VGUcretlerToplami
           , TahsilEdilenUcretler, IadeEdilenUcretler
           , PersonelId, TeklifTarihi, VeriKaynakId)
			VALUES (@yFirmId, @TalepId, @yAdayId, @yDonemTipiId, @yTalepTipiId
			, 0, 0, 0, 0 -- IsUcretli
			, 0    -- SertifikaUcreti
			, 0, 0 -- BirSaat..
			, 0, 0, 0, 0 -- Kont..
			, 0, 0, 0, 0 -- Anlas..
			, 0, 0       -- Taksi..
			, 0, 0       -- ESina..
			, 0, 0       -- Serti..
			, 0, null,'', 0, 0    -- Odeme..
			, 0, 0, 0, 0, 0       -- Mebbi..
			, 0, 0, 0, 0, 0, 0, 0, 0 -- AlacakS..
			, 0, 0, 0, 0, 0, 0, 0, 0 -- BorcS..
			, 0, 0, 0, 0, 0, 0, 0, 0 -- VGSer..
            , 0, 0       -- Tahsi..
			, 0, null, 0    -- Perso..
			)
       print ' create :  SrcAdayUcret'
  end


  -- SrcAdayTakip Insert
  if ( Select count(*) ADET from dbo.[SrcAdayTakip] 
       where TalepId = @TalepId 
     ) = 0 
  begin 
     INSERT INTO dbo.SrcAdayTakip
           (FirmId, TalepId, AdayId,
            DonemTipiId, GrupTipiId, SubeTipiId,
            TalepTipiId, KayitTipiId, ZamanlamaTipiId,
            IsGrupSubeYok, IsActive,
            MebbisKurumOnayi, MebbisDurumTipiId,
            SertifikaYasSiniri, YasOnayiTipiId, YasHazirTarihi,
            DeneyimSartiTipiId, IsDeneyimEnAz, DeneyimSertifikaTipiId,
            OzurDurumuTipiId, OkutmanTalebi, TercumanTalebi, YabanciDilTipiId, IsKontejan, AracTipiId,
            BelgelerGeldi, BelgelerTarandi, BelgelerYuklendi, BorcDurumuTipiId,

            TeorikBaslamaTarihi, TeorikBitisTarihi, TeorikDersTipiId, 

            eSinavNo, eSinavDurumTipiId, eSinavMuracatTarihi, eSinavUcretTipiId, IseSinavBTeslimEdildi, 
            eSinavNoGirdigi, eSinavSonucTipiId, eSinavSonrasiTipiId, eSinavDetayId, eSinavBasariTarihi,

            UygulamaliDersKredisi, Arti4DersKredisi, TelafiDersKredisi, BasarisizDersKredisi,

            IsUygulamaliDersPlanli, UygulamaBaslamaTarihi, UygulamaBitisTarihi,
		    SimulatorDersToplami, EgitimAlaniDersToplami, AkanTrafikDersToplami, UygulamaliDersToplami,
            UygulamaliDersTipiId, IsUygulamaliDersMebbis,

            IsTelafiDersPlanli, TelafiDersNo, TelafiBaslamaTarihi, TelafiBitisTarihi,
            TelafiDersToplami, TelafiDersTipiId, IsTelafiDersMebbis,

            IsBasarisizDersPlanli, BasarisizDersNo, BasarisizBaslamaTarihi, BasarisizBitisTarihi,
            BasarisizDersToplami, BasarisizDersTipiId, IsBasarisizDersMebbis,

            IsArti4DersPlanli, Arti4BaslamaTarihi, Arti4BitisTarihi,
		    Arti4EgitimAlaniDersToplami, Arti4AkanTrafikDersToplami, Arti4DersToplami,
            Arti4DersTipiId, IsArti4DersMebbis,

			PlanlanacakEgitimTipiId, uSinavaHazirmiTipiId, IsUygSinavMebbisOnayi, 
			IsRandevuPlanlandi,  IsRandevuMebbis, RandevuTarihi,
            RandevuSaatTipiId, RandevuEgitimAraciId, RandevuPersonelId, 

            uSinavNo, uSinavDurumTipiId, uSinavUcretTipiId, IsuSinavBTeslimEdildi,
            uSinavNoGirdigi, uSinavSonucTipiId, uSinavSonrasiTipiId, uSinavDetayId, uSinavBasariTarihi,

            SertifikaDurumTipiId, SertifikaTarihi, DosyaYakti,
			Asama1TipiId, Asama1DetayTipiId, Asama2TipiId, Asama2DetayTipiId
			)
     VALUES
           (@yFirmId,  @TalepId, @yAdayId,  
		    @yDonemTipiId, @yGrupTipiId, @ySubeTipiId, 
            @yTalepTipiId,  0,  0,  -- AsamaTipiId, TalepTipiId, KayitTipiId, ZamanlamaTipiId,
            0,  0,              -- IsGrupSubeYok, IsActive,
            0,  0,              -- MebbisKurumOnayi, MebbisDurumTipiId,
            0,  0,  null,       -- SertifikaYasSiniri, YasOnayiTipiId, YasHazirTarihi,
            0,  0,  0,          -- DeneyimSartiTipiId, IsDeneyimEnAz, DeneyimSertifikaTipiId,
            0,  0,  0,  0, 0, 0,-- OzurDurumuTipiId, OkutmanTalebi, TercumanTalebi, YabanciDilTipiId, IsKontejan, AracTipiId,
            0,  0,  0,  0,      -- BelgelerGeldi, BelgelerTarandi, BelgelerYuklendi, BorcDurumuTipiId, 
            
            null, null,  0,     -- TeorikBaslamaTarihi, TeorikBitisTarihi, TeorikDersTipiId,

            0,  0, null, 0,  0, -- eSinavNo, eSinavDurumTipiId, eSinavMuracatTarihi, eSinavUcretTipiId, IseSinavBTeslimEdildi, 
            0,  0,  0,  0, null,-- eSinavNoGirdigi, eSinavSonucTipiId, eSinavSonrasiTipiId, eSinavDetayId, eSinavBasariTarihi,

            0,  0,  0,  0,      -- UygulamaliDersKredisi, Arti4DersKredisi, TelafiDersKredisi, BasarisizDersKredisi,
            
            0,  null, null,     -- IsUygulamaliDersPlanli, UygulamaBaslamaTarihi, UygulamaBitisTarihi, 
            0,  0,  0,  0,      -- SimulatorDersToplami, EgitimAlaniDersToplami, AkanTrafikDersToplami, UygulamaliDersToplami
            0,  0,              -- UygulamaliDersTipiId, IsUygulamaliDersMebbis,

            0,  0,  null, null, -- IsTelafiDersPlanli, TelafiDersNo, TelafiBaslamaTarihi, TelafiBitisTarihi, 
            0,  0,  0,          -- TelafiDersToplami, TelafiDersTipiId, IsTelafiDersMebbis,

            0,  0,  null, null, -- IsBasarisizDersPlanli, BasarisizDersNo, BasarisizBaslamaTarihi, BasarisizBitisTarihi, 
            0,  0,  0,          -- BasarisizDersToplami, BasarisizDersTipiId, IsBasarisizDersMebbis,

            0,  null, null,     -- IsArti4DersPlanli, Arti4BaslamaTarihi, Arti4BitisTarihi, 
            0,  0,  0,          -- Arti4EgitimAlaniDersToplami, Arti4AkanTrafikDersToplami, Arti4DersToplami, 
            0,  0,              -- Arti4DersTipiId, IsArti4DersMebbis,

			0,  0,  0,          -- PlanlanacakEgitimTipiId, uSinavaHazirmiTipiId, IsUygSinavMebbisOnayi, 
			0,  0,    null,     -- IsRandevuPlanlandi,  IsRandevuMebbis, RandevuTarihi,
            0,  null, null,     -- RandevuSaatTipiId, RandevuEgitimAraciId, RandevuPersonelId, 

            0,  0,  0,  0,      -- uSinavNo, uSinavDurumTipiId, uSinavUcretTipiId, IsuSinavBTeslimEdildi,
            0,  0,  0,  0, null,-- uSinavNoGirdigi, uSinavSonucTipiId, uSinavSonrasiTipiId, uSinavDetayId, uSinavBasariTarihi,

            0,  null,  0,       -- SertifikaDurumTipiId, SertifikaTarihi, DosyaYakti
			0,  0,  0, 0        -- Asama1TipiId, Asama1DetayTipiId, Asama2TipiId, Asama2DetayTipiId  
			)       
     print ' create : [SrcAdayTakip]'

  end -- SrcAdayTakip


END -- procedure

/*CreateProcedureEnd*/

