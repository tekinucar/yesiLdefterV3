/*CreateProcedure*/

CREATE PROCEDURE [dbo].[prc_MtskAdayTakipAdayKayitlariToplami] (@FirmId int, @DonemTipiId int)  
AS BEGIN

--Declare @FirmId int = 30
--Declare @DonemTipiId int = 202407

-- TalepTipi
Select 
   tip.KonuId
 , tip.KonuCaption   
 , tip.TalepTipi as KonuAciklama
 , count(takip.Id) as AdaySayisi 

From MtskAdayTakip as takip
     left outer join Lkp.MtskAdayTakipTalepTipi as tip on 
	   ( takip.TalepTipiId = tip.Id )
Where FirmId = @FirmId
and   DonemTipiId = @DonemTipiId

Group by 
   tip.KonuId
 , tip.KonuCaption   
 , tip.TalepTipi
 
union all

-- KayitTipi
Select 
   tip.KonuId
 , tip.KonuCaption   
 , tip.KayitTipi as KonuAciklama
 , count(takip.Id) as AdaySayisi 

From MtskAdayTakip as takip
     left outer join Lkp.MtskAdayTakipKayitTipi as tip on 
	   ( takip.KayitTipiId = tip.Id )
Where FirmId = @FirmId
and   DonemTipiId = @DonemTipiId

Group by 
   tip.KonuId
 , tip.KonuCaption   
 , tip.KayitTipi

union all

-- ZamanlamaTipi
Select 
   tip.KonuId
 , tip.KonuCaption   
 , tip.ZamanlamaTipi as KonuAciklama
 , count(takip.Id) as AdaySayisi 

From MtskAdayTakip as takip
     left outer join Lkp.MtskAdayTakipZamanlamaTipi as tip on 
	   ( takip.ZamanlamaTipiId = tip.Id )
Where FirmId = @FirmId
and   DonemTipiId = @DonemTipiId

Group by 
   tip.KonuId
 , tip.KonuCaption   
 , tip.ZamanlamaTipi

union all

-- IsGrupSubeYok
Select 
   1140 as KonuId
 , 'Grup ve şube' as KonuCaption   
 , 'Şubesi belli olmayan adaylar' as KonuAciklama
 , count(takip.Id) as AdaySayisi 

From MtskAdayTakip as takip
Where FirmId = @FirmId
and   DonemTipiId = @DonemTipiId
and   IsGrupSubeYok = 1

union all

-- IsEgitimDevamEdiyor
Select 
   1150 as KonuId
 , 'Grup ve şube' as KonuCaption   
 , 'Süreci devam eden adaylar' as KonuAciklama
 , count(takip.Id) as AdaySayisi 

From MtskAdayTakip as takip
Where FirmId = @FirmId
and   DonemTipiId = @DonemTipiId
and   IsEgitimDevamEdiyor = 1

union all

-- MebbisKurumOnayi yok
Select 
   1161 as KonuId
 , 'Mebbis kurum onayı' as KonuCaption   
 , 'Onaysız' as KonuAciklama
 , count(takip.Id) as AdaySayisi 

From MtskAdayTakip as takip
Where FirmId = @FirmId
and   DonemTipiId = @DonemTipiId
and   MebbisKurumOnayi = 0

union all

-- MebbisKurumOnayi var
Select 
   1162 as KonuId
 , 'Mebbis kurum onayı' as KonuCaption   
 , 'Onaylandı' as KonuAciklama
 , count(takip.Id) as AdaySayisi 

From MtskAdayTakip as takip
Where FirmId = @FirmId
and   DonemTipiId = @DonemTipiId
and   MebbisKurumOnayi = 1

union all

-- MebbisDurumTipi
Select 
   tip.KonuId
 , tip.KonuCaption   
 , tip.MebbisDurumTipi as KonuAciklama
 , count(takip.Id) as AdaySayisi 

From MtskAdayTakip as takip
     left outer join Lkp.MtskAdayTakipMebbisDurumTipi as tip on 
	   ( takip.MebbisDurumTipiId = tip.Id )
Where FirmId = @FirmId
and   DonemTipiId = @DonemTipiId

Group by 
   tip.KonuId
 , tip.KonuCaption   
 , tip.MebbisDurumTipi

union all

-- YasOnayiTipi
Select 
   tip.KonuId
 , tip.KonuCaption   
 , tip.YasOnayiTipi as KonuAciklama
 , count(takip.Id) as AdaySayisi 

From MtskAdayTakip as takip
     left outer join Lkp.MtskAdayTakipYasOnayiTipi as tip on 
	   ( takip.YasOnayiTipiId = tip.Id )
Where FirmId = @FirmId
and   DonemTipiId = @DonemTipiId

Group by 
   tip.KonuId
 , tip.KonuCaption   
 , tip.YasOnayiTipi

union all

-- OzurDurumTipi
Select 
   tip.KonuId
 , tip.KonuCaption   
 , tip.OzurDurumuTipi as KonuAciklama
 , count(takip.Id) as AdaySayisi 

From MtskAdayTakip as takip
     left outer join Lkp.MtskAdayTakipOzurDurumuTipi as tip on 
	   ( takip.OzurDurumTipiId = tip.Id )
Where FirmId = @FirmId
and   DonemTipiId = @DonemTipiId

Group by 
   tip.KonuId
 , tip.KonuCaption   
 , tip.OzurDurumuTipi

union all

-- Belgeleri eksik olanlar
Select 
   1231 as KonuId
 , 'Belgeler' as KonuCaption   
 , 'Belgeleri eksik olan' as KonuAciklama
 , count(takip.Id) as AdaySayisi 

From MtskAdayTakip as takip
Where FirmId = @FirmId
and   DonemTipiId = @DonemTipiId
and   takip.BelgelerGeldi = 0 
and  (takip.KayitTipiId = 2 or takip.KayitTipiId = 3 ) 

union all

-- Belgeleri taranmayanlar
Select 
   1232 as KonuId
 , 'Belgeler' as KonuCaption   
 , 'Belgeleri taranmayan' as KonuAciklama
 , count(takip.Id) as AdaySayisi 

From MtskAdayTakip as takip
Where FirmId = @FirmId
and   DonemTipiId = @DonemTipiId
and   takip.BelgelerTarandi = 0 
and  (takip.KayitTipiId = 2 or takip.KayitTipiId = 3 ) 

union all

-- Belgeleri yüklenmeyenler
Select 
   1233 as KonuId
 , 'Belgeler' as KonuCaption   
 , 'Belgeleri Mebbise yüklenmeyen' as KonuAciklama
 , count(takip.Id) as AdaySayisi 

From MtskAdayTakip as takip
Where FirmId = @FirmId
and   DonemTipiId = @DonemTipiId
and   takip.BelgelerYuklendi = 0 
and  (takip.KayitTipiId = 2 or takip.KayitTipiId = 3 ) 

union all

-- EgitimSureciTipi
Select 
   tip.KonuId
 , tip.KonuCaption   
 , tip.EgitimSureciTipi as KonuAciklama
 , count(takip.Id) as AdaySayisi 

From MtskAdayTakip as takip
     left outer join Lkp.MtskAdayTakipEgitimSureciTipi as tip on 
	   ( takip.EgitimSureciTipiId = tip.Id )
Where FirmId = @FirmId
and   DonemTipiId = @DonemTipiId

Group by 
   tip.KonuId
 , tip.KonuCaption   
 , tip.EgitimSureciTipi


END -- procedure

/*CreateProcedureEnd*/