/*CreateTable*/

begin transaction

 create table MtskAdayTakip
 (
   Id                    Int IDENTITY(1,1) not null, 
   FirmId                Int       not null,
   TalepId               Int       not null, 
   AdayId                Int       not null, 
   DonemTipiId           Int           null,
   GrupTipiId            SmallInt      null,
   SubeTipiId            SmallInt      null,
   AsamaTipiId           SmallInt      null, /* Şu anda aday hangi aşamada */
   
   -- MtskAdayTalep trigger içinden prc_MtskAdayTakipSingleSet çağırılıyor
   -- 10 kayıt aşaması
   TalepTipiId            SmallInt     null, /*  prc_MtskAdayTakipSingleSet üzerinden işaretleniyor : 1. sertifika, 2. (2.+4 hak), 3. Nakil 2.+4hak, 4. 100Ceza, 5. Özel Uyg Ders   */ 
   KayitTipiId            SmallInt     null, /*  prc_MtskAdayTakipSingleSet üzerinden işaretleniyor : 1. Ön kayıt, 2. Kayıt aşamasında, 3. Kesin Kayıt ...  */ 
   ZamanlamaTipiId        SmallInt     null, /*  prc_MtskAdayTakipSingleSet üzerinden işaretleniyor : */
   IsGrupSubeYok          Bit          null, /*  prc_MtskAdayTakipSingleSet üzerinden işaretleniyor : grup veya şubesi belli değilse  */
   IsActive               Bit          null, /*  Aktif talep : süreci devam edenler = 1, değilse = 0 : sorgularda kolaylık olsun diye var  */ 
   MebbisKurumOnayi       Bit          null, /*  prc_MtskAdayTakipSingleSet üzerinden işaretleniyor : 0-Onaysız, 1-Onaylandı */	
   MebbisDurumTipiId      SmallInt     null, /*  prc_MtskAdayTakipSingleSet üzerinden işaretleniyor : detayı aşağıda*/
   SertifikaYasSiniri     SmallInt     null, /*  trg_MtskAdayTalep          üzerinden prc_MtskAdayTalepYasiniHesapla çağırılıyor : almak istediği sertifikanın yaş sınırı  */  
   YasOnayiTipiId         SmallInt     null, /*  trg_MtskAdayTalep          üzerinden prc_MtskAdayTalepYasiniHesapla çağırılıyor : */
   YasHazirTarihi         Date         null, /*  trg_MtskAdayTalep          üzerinden prc_MtskAdayTalepYasiniHesapla çağırılıyor : yaş sınırını doldurduğu tarih */
   DeneyimSartiTipiId     SmallInt     null, /*  prc_MtskAdayTakipSingleSet içinde fnc_getSertifikaDeneyimSarti ile tespit ediliyor */       
   IsDeneyimEnAz          Bit          null, /*  prc_MtskAdayTakipSingleSet üzerinden işaretleniyor  */
   DeneyimSertifikaTipiId SmallInt     null, /*  prc_MtskAdayTakipSingleSet üzerinden işaretleniyor  */
   OzurDurumuTipiId       SmallInt     null, /*  trg_MtskAdaySaglik         üzerinden işaretleniyor  */
   OkutmanTalebi          Bit          null, /*  trg_MtskAdaySaglik         üzerinden işaretleniyor  */
   TercumanTalebi         Bit          null, /*  trg_MtskAdaySaglik         üzerinden işaretleniyor  */
   YabanciDilTipiId       SmallInt     null, /*  trg_MtskAdaySaglik         üzerinden işaretleniyor  */
   IsKontejan             Bit          null, /*  trg_MtskAdayUcret          üzerinden işaretleniyor  */
   
   -- MtskAdayAdliSicil, ...Adres, ...Imza, ...Ogrenim, ...Saglik, ...Sozlesme MtskAdayBelgeler tablosunu tetikliyor
   -- MtskAdayBelgeler trigger da buraya yazıyor
   -- 30
   BelgelerGeldi          Bit          null, /* prc_MtskAdayTakipSingleSet üzerinden işaretleniyor : tamamı geldiyse */
   BelgelerTarandi        Bit          null, /* trg_MtskAdayBelgeler       üzerinden işaretleniyor : tamamı tarandıysa */
   BelgelerYuklendi       Bit          null, /* trg_MtskAdayBelgeler       üzerinden işaretleniyor : tamamı yüklendiyse */

   -- 40 ödemeleri
   BorcDurumuTipiId         SmallInt     null,
   
   --100 eSınav aşaması
   TeorikBaslamaTarihi    Date         null,
   TeorikBitisTarihi      Date         null,
   --TeorikDersToplami      SmallInt     null, iptal gerek yok
   TeorikDersTipiId       SmallInt     null,--104
   
   -- 110
   eSinavNo               SmallInt     null, /* gireceği sınav no */
   eSinavDurumTipiId      SmallInt     null,
   eSinavMuracatTarihi    Date         null, /* Müracat Tarihi */
   eSinavUcretTipiId      SmallInt     null, /* kendisi yatıracak, biz yatıracağız */
   IseSinavBTeslimEdildi  Bit          null, /* e-Sınav belgesi kursiyere teslim edildi veya edilmedi */
   -- 120
   eSinavNoGirdigi        SmallInt     null,  
   eSinavSonucTipiId      SmallInt     null, /* Başarılı, Başarısız, Girmedi */
   eSinavSonrasiTipiId    SmallInt     null, 
   eSinavDetayId          Int          null, /* en son hangi sınavsa onun id si. sınav1 ise sınav1 in id si, 2 ise 2 nin id si, 3, 4 ... */
   eSinavBasariTarihi     Date         null,

   --200 uygulama ders + Sınav aşaması
   
   IsUygulamaliDersPlanli Bit          null,
   UygulamaBaslamaTarihi  Date         null,
   UygulamaBitisTarihi    Date         null,
   SimulatorDersToplami   SmallInt     null,
   EgitimAlaniDersToplami SmallInt     null,
   AkanTrafikDersToplami  SmallInt     null, /* prc_MtskUygulamaDersPlaniSaatleriGuncelle  içinde hesplanıyor */
   UygulamaliDersToplami  SmallInt     null, /* prc_MtskUygulamaDersPlaniSaatleriGuncelle  içinde hesplanıyor */
   UygulamaliDersTipiId   SmallInt     null,
   IsUygulamaDersMebbis   Bit          null, /* Mebbise aktarılmadı, aktarrıldı */

   --210
   IsBasarisizDersPlanli  Bit          null,
   BasarisizDersNo        SmallInt     null,
   BasarisizBaslamaTarihi Date         null,
   BasarisizBitisTarihi   Date         null,
   BasarisizDersToplami   SmallInt     null,
   BasarisizDersTipiId    SmallInt     null,
   IsBasarisizDersMebbis  Bit          null, /* Mebbise aktarılmadı, aktarrıldı */
      
   --220
   IsArti4DersPlanli           Bit          null,
   Arti4BaslamaTarihi          Date         null,
   Arti4BitisTarihi            Date         null,
   Arti4EgitimAlaniDersToplami SmallInt     null,
   Arti4AkanTrafikDersToplami  SmallInt     null, /* prc_MtskUygulamaDersPlaniSaatleriGuncelle  içinde hesplanıyor */
   Arti4DersToplami            SmallInt     null, /* prc_MtskUygulamaDersPlaniSaatleriGuncelle  içinde hesplanıyor */
   Arti4DersTipiId             SmallInt     null,
   IsArti4DersMebbis           Bit          null, /* Mebbise aktarılmadı, aktarrıldı */

   -- 230 
   PlanlanacakEgitimTipiId SmallInt     null, /* 
   uSinavaHazirmiTipiId    SmallInt     null, /* 1. Onay, 2. Sınav için hazır değil : bu seçimi usta öğretici karar veriyor */
   IsUygSinavMebbisOnayi   Bit          null, /* uSinavDurumTipi = 4, 'Uygulama sınavı için MEBBİS de onaylanacak' için gerekli */
   IsRandevuPlanlandi      Bit          null, /* Randevu tarafında planlanınca burası True olacak */
   IsRandevuMebbis         Bit          null, /* Randevu Mebbise aktarılınca */
   RandevuTarihi           Date         null, /* Randevu tarafında planınca plan tarihi buraya set ediliyor */ 
   RandevuSaatTipiId       SmallInt     null, /* Randevu tarafında planınca plan tarihi buraya set ediliyor */   
   RandevuEgitimAraciId    Varchar(10)  null, /* uygulama sınav randevusundaki araç */  
   RandevuPersonelId       Varchar(20)  null, /* uygulama sınavında sorumlu olan öğretmen */  


   -- 240 
   uSinavNo                SmallInt     null,
   uSinavDurumTipiId       SmallInt     null,
   -- 243 boş kalacak
   uSinavUcretTipiId       SmallInt     null, /* kendisi yatıracak, biz yatıracağız */
   IsuSinavBTeslimEdildi   Bit          null, /* uygulama sınav belgesi kursiyere teslim edildi veya edilmedi */
   -- 250
   uSinavNoGirdigi         SmallInt     null,  
   uSinavSonucTipiId       SmallInt     null, /* Başarılı, Başarısız, Girmedi */
   uSinavSonrasiTipiId     SmallInt     null, 
   uSinavDetayId           Int          null, /* en son hangi sınavsa onun id si. sınav1 ise sınav1 in id si, 2 ise 2 nin id si, 3, 4 ... */
   uSinavBasariTarihi      Date         null,

   --260 sertifika aşaması
   SertifikaDurumTipiId    SmallInt     null,
   SertifikaTarihi         Date         null,
   DosyaYakti              Bit          null, -- false/true
   
   constraint		pk_MtskAdayTakip primary key (Id)
 )
  
 grant select, insert, update, delete on MtskAdayTakip to public

 create index X_MtskAdayTakip01 on MtskAdayTakip (FirmId, TalepId)
 create index X_MtskAdayTakip02 on MtskAdayTakip (AdayId)
   
commit transaction

/*CreateTableEnd*/






/* Tablonun her aday için gerekli olan satırı :  trg_MtskAday içinde insert ediliyor   */
/*
Delete from [Lkp].[MtskAdayTakipAsamaTipi]
INSERT INTO [Lkp].[MtskAdayTakipAsamaTipi] (Id, AsamaTipi)
 VALUES 
  ( 101,    N'Ön kayıt' ),
  ( 102,    N'Kayıt aşamasında' ),
  ( 103,    N'Kesin kayıt' ),

  ( 201,    N'Teorik ders başlamadı'),
  ( 202,    N'Teorik ders alıyor'),
  ( 203,    N'Teorik dersleri tamamladı'), 

  ( 211,    N'1. e-Sınav başvurusu yapılacak'  ),
  ( 212,    N'1. e-Sınav başvurusu yapıldı' ),
  ( 213,    N'1. e-Sınav sonucu okunacak' ),
  ( 214,    N'1. e-Sınav başarılı, uyg. ders aşamasına geçti' ),
  ( 215,    N'1. e-Sınav başarısız' ),

  ( 221,    N'2. e-Sınav başvurusu yapılacak'  ),
  ( 222,    N'2. e-Sınav başvurusu yapıldı' ),
  ( 223,    N'2. e-Sınav sonucu okunacak' ),
  ( 224,    N'2. e-Sınav başarılı, uyg. ders aşamasına geçti' ),
  ( 225,    N'2. e-Sınav başarısız' ),

  ( 231,    N'3. e-Sınav başvurusu yapılacak'  ),
  ( 232,    N'3. e-Sınav başvurusu yapıldı' ),
  ( 233,    N'3. e-Sınav sonucu okunacak' ),
  ( 234,    N'3. e-Sınav başarılı, uyg. ders aşamasına geçti' ),
  ( 235,    N'3. e-Sınav başarısız' ),

  ( 241,    N'4. e-Sınav başvurusu yapılacak'  ),
  ( 242,    N'4. e-Sınav başvurusu yapıldı' ),
  ( 243,    N'4. e-Sınav sonucu okunacak' ),
  ( 244,    N'4. e-Sınav başarılı, uyg. ders aşamasına geçti' ),
  ( 245,    N'4. e-Sınav başarısız, dosya yaktı' ),
  ( 246,    N'Tüm e-Sınav hakkı bitti' ),

  ( 301,    N'Uygulamalı dersler planlanacak' ),
  ( 302,    N'Uygulamalı dersler planlandı, MEBBİSe aktarılacak' ),
  ( 303,    N'Uygulamalı dersler için beklemede' ),
  ( 304,    N'Uygulamalı dersleri alıyor' ),
  ( 305,    N'Uygulamalı dersleri tamamladı' ),

  ( 306,    N'Uygulama sınav için hazır değil' ),
  ( 307,    N'Uygulama sınav için MEBBİS de onaylanacak' ),

  ( 311,    N'1. Uygulama sınav randevusu planlanacak' ),
  ( 312,    N'1. Uygulama sınav randevusu MEBBİSe aktarılacak' ),
  ( 313,    N'1. Uygulama sınavına girecek' ),
  ( 314,    N'1. Uygulama sınav sonucu okunacak' ),
  ( 315,    N'1. Uygulama sınav sonucu okundu' ),
  ( 316,    N'1. Uygulama sınav başarılı, sertifika aşamasına geçti' ),

  ( 321,    N'1. başarısız aday eğitimi planlanacak' ),
  ( 322,    N'1. başarısız aday eğitimi MEBBİSe aktarılacak' ),
  ( 323,    N'1. başarısız aday eğitimi için beklemede' ),
  ( 324,    N'1. başarısız aday eğitimini alıyor' ),
  ( 325,    N'1. başarısız aday eğitimi tamamlandı' ),
  ( 326,    N'Eğitime gerek yok (Sınava girmedi)' ),

*/



/*CreateLkpTable*/

begin transaction


-- ------------------------------------------------------- 
-- TalepTipiId
-- ------------------------------------------------------- 
IF EXISTS (Select * From sys.objects WHERE name = 'MtskAdayTakipTalepTipi')
drop table [Lkp].[MtskAdayTakipTalepTipi]

create table [Lkp].[MtskAdayTakipTalepTipi]
(
   Id               Int Unique not null, 
   TalepTipi        nVarchar(50)   null,
   KonuGrupId       SmallInt       null,
   KonuId           Int            null,
   KonuCaption      nVarchar(20)   null,
   ChartCaption     nVarchar(20)   null,
   FormCaption      nVarchar(15)   null,
   
   constraint  pk_MtskAdayTakipTalepTipi primary key (Id)
)

Delete from [Lkp].[MtskAdayTakipTalepTipi]
INSERT INTO [Lkp].[MtskAdayTakipTalepTipi] (Id, TalepTipi, KonuGrupId, KonuId, KonuCaption, ChartCaption, FormCaption)
 VALUES 
  ( 1,    N'Sertifika',             1, 1111, 'Talep tipi', '', 'Yeni aday kaydı'),
  ( 2,    N'2.+4 hak ',             1, 1112, 'Talep tipi', '', ''),
  ( 3,    N'Nakil 2.+4 hak',        1, 1113, 'Talep tipi', '', ''),
  ( 4,    N'100 Ceza',              1, 1114, 'Talep tipi', '', ''),
  ( 5,    N'Özel direksiyon dersi', 1, 1115, 'Talep tipi', '', ''),
  ( 6,    N'Özel teorik dersi',     1, 1116, 'Talep tipi', '', '')



-- ------------------------------------------------------- 
-- KayitTipiId
-- ------------------------------------------------------- 
IF EXISTS (Select * From sys.objects WHERE name = 'MtskAdayTakipKayitTipi')
drop table [Lkp].[MtskAdayTakipKayitTipi]

create table [Lkp].[MtskAdayTakipKayitTipi]
(
   Id               Int Unique not null, 
   KayitTipi        nVarchar(30)   null,
   KonuGrupId       SmallInt       null,
   KonuId           Int            null,
   KonuCaption      nVarchar(20)   null,
   ChartCaption     nVarchar(20)   null,
   FormCaption      nVarchar(30)   null,

   constraint  pk_MtskAdayTakipKayitTipi primary key (Id)
)

Delete from [Lkp].[MtskAdayTakipKayitTipi]
INSERT INTO [Lkp].[MtskAdayTakipKayitTipi] (Id, KayitTipi, KonuGrupId, KonuId, KonuCaption, ChartCaption, FormCaption)
 VALUES 
  ( 1,    N'Ön kayıt',          1, 1121, 'Kayıt durumu',  'Ön kayıt',     'Yeni aday kaydı' ),
  ( 2,    N'Kayıt aşamasında',  1, 1122, 'Kayıt durumu',  'K.Aşamasında', 'Mebbise bağlan .' ),
  ( 3,    N'Kesin kayıt',       1, 1123, 'Kayıt durumu',  'Kesin kay.', '' )


-- ------------------------------------------------------- 
-- ZamanlamaTipiId
-- ------------------------------------------------------- 
IF EXISTS (Select * From sys.objects WHERE name = 'MtskAdayTakipZamanlamaTipi')
drop table [Lkp].[MtskAdayTakipZamanlamaTipi]

create table [Lkp].[MtskAdayTakipZamanlamaTipi]
(
   Id               Int Unique not null, 
   ZamanlamaTipi    nVarchar(30)   null,
   KonuGrupId       SmallInt       null,
   KonuId           Int            null,
   KonuCaption      nVarchar(20)   null,
   ChartCaption     nVarchar(20)   null,
   FormCaption      nVarchar(15)   null,
   
   constraint  pk_MtskAdayTakipZamanlamaTipi primary key (Id)
)

Delete from [Lkp].[MtskAdayTakipZamanlamaTipi]
INSERT INTO [Lkp].[MtskAdayTakipZamanlamaTipi] (Id, ZamanlamaTipi, KonuGrupId, KonuId, KonuCaption, ChartCaption, FormCaption)
 VALUES 
  ( 0,  N'Belirsiz',                 1, 1130, 'Zamanlama',  '', '' ),
  ( 1,  N'Geçmiş dönem devam eden',  1, 1131, 'Zamanlama',  '', '' ),
  ( 2,  N'Bu dönem',                 1, 1132, 'Zamanlama',  '', '' ),
  ( 3,  N'Gelecek ay',               1, 1133, 'Zamanlama',  '', '' ),
  ( 4,  N'İleriki dönemler',         1, 1134, 'Zamanlama',  '', '' ),
  ( 5,  N'Sertifikasını hak etmiş',  1, 1135, 'Zamanlama',  '', '' )



-- ------------------------------------------------------- 
-- GrupSubeTipiId -- bu field MtskAdayTakip tablosunda yok
-- bazı koşulları takip için var
-- ------------------------------------------------------- 
IF EXISTS (Select * From sys.objects WHERE name = 'MtskAdayTakipGrupSubeTipi')
drop table [Lkp].[MtskAdayTakipGrupSubeTipi]

create table [Lkp].[MtskAdayTakipGrupSubeTipi]
(
   Id               Int Unique not null, 
   GrupSubeTipi     nVarchar(50)   null,
   KonuGrupId       SmallInt       null,
   KonuId           Int            null,
   KonuCaption      nVarchar(20)   null,
   ChartCaption     nVarchar(20)   null,
   FormCaption      nVarchar(15)   null,
   
   constraint  pk_MtskAdayTakipGrupSubeTipi primary key (Id)
)

Delete from [Lkp].[MtskAdayTakipGrupSubeTipi]
INSERT INTO [Lkp].[MtskAdayTakipGrupSubeTipi] (Id, GrupSubeTipi, KonuGrupId, KonuId, KonuCaption, ChartCaption, FormCaption)
 VALUES 
  ( 1,  N'Grup veya şubesi belli olmayan adaylar',   1, 1141, 'Grup ve şube',  '', '' )


-- ------------------------------------------------------- 
-- MebbisOnayiTipiId -- bu field MtskAdayTakip tablosunda yok
-- bazı koşulları takip için var
-- ------------------------------------------------------- 
IF EXISTS (Select * From sys.objects WHERE name = 'MtskAdayTakipMebbisOnayiTipi')
drop table [Lkp].[MtskAdayTakipMebbisOnayiTipi]

create table [Lkp].[MtskAdayTakipMebbisOnayiTipi]
(
   Id                Int Unique not null, 
   MebbisOnayiTipi   nVarchar(50)   null,
   KonuGrupId        SmallInt       null,
   KonuId            Int            null,
   KonuCaption       nVarchar(20)   null,
   ChartCaption      nVarchar(20)   null,
   FormCaption       nVarchar(30)   null,
   
   constraint  pk_MtskAdayTakipMebbisOnayiTipi primary key (Id)
)

Delete from [Lkp].[MtskAdayTakipMebbisOnayiTipi]
INSERT INTO [Lkp].[MtskAdayTakipMebbisOnayiTipi] (Id, MebbisOnayiTipi, KonuGrupId, KonuId, KonuCaption, ChartCaption, FormCaption)
 VALUES 
  ( 0,  N'Onaysız',        1, 1161, 'Mebbis kurum onayı',  '', 'Mebbise bağlan ..' ),
  ( 1,  N'Onaylandı',      1, 1162, 'Mebbis kurum onayı',  '', '' )



-- ------------------------------------------------------- 
-- MebbisDurumTipiId
-- ------------------------------------------------------- 
IF EXISTS (Select * From sys.objects WHERE name = 'MtskAdayTakipMebbisDurumTipi')
drop table [Lkp].[MtskAdayTakipMebbisDurumTipi]

create table [Lkp].[MtskAdayTakipMebbisDurumTipi]
(
   Id               Int Unique not null, 
   MebbisDurumTipi  nVarchar(70)   null,
   KonuGrupId       SmallInt       null,
   KonuId           Int            null,
   KonuCaption      nVarchar(20)   null,
   ChartCaption     nVarchar(20)   null,
   FormCaption      nVarchar(15)   null,
   
   constraint  pk_MtskAdayTakipMebbisDurumTipi primary key (Id)
)

Delete from [Lkp].[MtskAdayTakipMebbisDurumTipi]
INSERT INTO [Lkp].[MtskAdayTakipMebbisDurumTipi] (Id, MebbisDurumTipi, KonuGrupId, KonuId, KonuCaption, ChartCaption, FormCaption)
 VALUES 
  (-1,  N'Belirsiz',                     1, 1169, 'Mebbis durumu',  '', ''  ),
  ( 0,  N'Kursa Başvuru Aşamasında',     1, 1170, 'Mebbis durumu',  '', ''  ),
  ( 1,  N'Teorik Sınav Aşamasında',      1, 1171, 'Mebbis durumu',  '', ''  ),
  ( 2,  N'Uygulama Sınav Aşamasında',    1, 1172, 'Mebbis durumu',  '', ''  ),
  ( 3,  N'Teorik Sınav Hakkı Doldu',     1, 1173, 'Mebbis durumu',  '', ''  ),
  ( 4,  N'Uygulama Sınav Hakkı Doldu',   1, 1174, 'Mebbis durumu',  '', ''  ),
  ( 5,  N'Sertifika Almaya Hak Kazandı', 1, 1175, 'Mebbis durumu',  '', ''  ),
  ( 6,  N'Sertifikası İptal Edildi',     1, 1176, 'Mebbis durumu',  '', ''  ),
  ( 7,  N'e-Sınav Aşamasında',           1, 1177, 'Mebbis durumu',  '', ''  ),
  ( 8,  N'e-Sınav Test Aşamasında',      1, 1178, 'Mebbis durumu',  '', ''  ),
  ( 9,  N'e-Sınavdan Başarısız Oldu',    1, 1179, 'Mebbis durumu',  '', ''  ),
  ( 10,  N'e-Sınav Hakkı Doldu',         1, 1180, 'Mebbis durumu',  '', ''  ),
  ( 11,  N'Kaydı Silindi',               1, 1181, 'Mebbis durumu',  '', ''  ),
  ( 12,  N'Ceza Kaydı Var',              1, 1182, 'Mebbis durumu',  '', ''  ),
  ( 13,  N'Teorik Dersten Muaf',         1, 1183, 'Mebbis durumu',  '', ''  ),
  ( 14,  N'Adli Sicil Kaydı Uygun Olmadığından Dönem Kaydı Durdurulmuştur.', 1, 1184, 'Mebbis durumu',  '', ''  ),
  ( 22,  N'2.Direksiyon Aşamasında',     1, 1185, 'Mebbis durumu',  '', ''  )



-- ------------------------------------------------------- 
-- YasOnayiTipiId
-- ------------------------------------------------------- 
IF EXISTS (Select * From sys.objects WHERE name = 'MtskAdayTakipYasOnayiTipi')
drop table [Lkp].[MtskAdayTakipYasOnayiTipi]

create table [Lkp].[MtskAdayTakipYasOnayiTipi]
(
   Id               Int Unique not null, 
   YasOnayiTipi     nVarchar(50)   null,
   KonuGrupId       SmallInt       null,
   KonuId           Int            null,
   KonuCaption      nVarchar(20)   null,
   ChartCaption     nVarchar(20)   null,
   FormCaption      nVarchar(15)   null,
   
   constraint  pk_MtskAdayTakipYasOnayiTipi primary key (Id)
)

Delete from [Lkp].[MtskAdayTakipYasOnayiTipi]
INSERT INTO [Lkp].[MtskAdayTakipYasOnayiTipi] (Id, YasOnayiTipi, KonuGrupId, KonuId, KonuCaption, ChartCaption, FormCaption)
 VALUES 
  ( 0,    N'Tanımsız',                      1, 1210, 'Yaş onayı', '', ''),
  ( 1,    N'Yaşı tutmuyor',                 1, 1211, 'Yaş onayı', '', ''),
  ( 2,    N'Yaş için bekleme süresi dolan', 1, 1212, 'Yaş onayı', '', ''),
  ( 3,    N'Muhafiyetle onaylı',            1, 1213, 'Yaş onayı', '', ''),
  ( 4,    N'Doğum tarihi yok, belirsiz',    1, 1214, 'Yaş onayı', '', ''),
  ( 5,    N'Yaşı tutuyor',                  1, 1215, 'Yaş onayı', '', ''),
  ( 6,    N'Yaş kontrolü yok',              1, 1216, 'Yaş onayı', '', '')



-- ------------------------------------------------------- 
-- DeneyimSartiTipiId
-- ------------------------------------------------------- 
IF EXISTS (Select * From sys.objects WHERE name = 'MtskAdayTakipDeneyimSartiTipi')
drop table [Lkp].[MtskAdayTakipDeneyimSartiTipi]

create table [Lkp].[MtskAdayTakipDeneyimSartiTipi]
(
   Id                Int Unique not null, 
   DeneyimSartiTipi  nVarchar(50)   null,
   KonuGrupId        SmallInt       null,
   KonuId            Int            null,
   KonuCaption       nVarchar(20)   null,
   ChartCaption      nVarchar(20)   null,
   FormCaption       nVarchar(15)   null,
   
   constraint  pk_MtskAdayTakipDeneyimSartiTipi primary key (Id)
)

Delete from [Lkp].[MtskAdayTakipDeneyimSartiTipi]
INSERT INTO [Lkp].[MtskAdayTakipDeneyimSartiTipi] (Id, DeneyimSartiTipi, KonuGrupId, KonuId, KonuCaption, ChartCaption, FormCaption)
 VALUES 
  ( 1,    N'Şart yok',     1, 1221, 'Deneyim şartı', '', ''),
  ( 2,    N'Uygun',        1, 1222, 'Deneyim şartı', '', ''),
  ( 3,    N'Uygun değil',  1, 1223, 'Deneyim şartı', '', '')


-- ------------------------------------------------------- 
-- OzurDurumuTipiId
-- ------------------------------------------------------- 
IF EXISTS (Select * From sys.objects WHERE name = 'MtskAdayTakipOzurDurumuTipi')
drop table [Lkp].[MtskAdayTakipOzurDurumuTipi]

create table [Lkp].[MtskAdayTakipOzurDurumuTipi]
(
   Id               Int Unique Not null,
   OzurDurumuTipi   nVarchar(60)   null,
   KonuGrupId       SmallInt       null,
   KonuId           Int            null,
   KonuCaption      nVarchar(20)   null,
   ChartCaption     nVarchar(20)   null,
   FormCaption      nVarchar(15)   null,

   constraint  pk_MtskAdayTakipOzurDurumuTipi primary key (Id)
)

Delete from [Lkp].[MtskAdayTakipOzurDurumuTipi]
INSERT INTO [Lkp].[MtskAdayTakipOzurDurumuTipi] (Id, OzurDurumuTipi, KonuGrupId, KonuId, KonuCaption, ChartCaption, FormCaption)
 VALUES 
  --(  0, N'Belirsiz',                                      1, 1230, 'Sağlık durumu', '', ''),
  --(  1, N'Engeli Yok',                                    1, 1231, 'Sağlık durumu', '', ''),
  (100, N'Ortopedik Engelli (Ellerini ve/veya Kollarını Kullanamıyor)', 1, 1232, 'Sağlık durumu', '', ''),
  (110, N'Ortopedik Engelli (Yürüyemiyor)',                 1, 1233, 'Sağlık durumu', '', ''),
  (120, N'İşitme, Dil veya Konuşma Engelli',                1, 1234, 'Sağlık durumu', '', ''),
  (140, N'Görme Engelli (Bir Gözü Görmüyor)',               1, 1235, 'Sağlık durumu', '', ''),
  (150, N'Görme Engelli (Büyüteç Yardımı İle Görebiliyor)', 1, 1236, 'Sağlık durumu', '', ''),
  (160, N'Süreğen hastalığı var.',                          1, 1237, 'Sağlık durumu', '', '')



-- ------------------------------------------------------- 
-- MtskAdayTakipYabanciDilTipiId
-- ------------------------------------------------------- 
IF EXISTS (Select * From sys.objects WHERE name = 'MtskAdayTakipYabanciDilTipi')
drop table [Lkp].[MtskAdayTakipYabanciDilTipi]

create table [Lkp].[MtskAdayTakipYabanciDilTipi]
(
   Id               Int Unique Not null,
   YabanciDilTipi   nVarchar(60)   null,
   KonuGrupId       SmallInt       null,
   KonuId           Int            null,
   KonuCaption      nVarchar(20)   null,
   ChartCaption     nVarchar(20)   null,
   FormCaption      nVarchar(15)   null,

   constraint  pk_MtskAdayTakipYabanciDilTipi primary key (Id)
)

Delete from [Lkp].[MtskAdayTakipYabanciDilTipi]
INSERT INTO [Lkp].[MtskAdayTakipYabanciDilTipi] (Id, YabanciDilTipiTipi, KonuGrupId, KonuId, KonuCaption, ChartCaption, FormCaption)
 VALUES 
 (  1, N'Arapça',      1, 1241, 'Yabancı dil', '', ''),
 (  2, N'Çince',       1, 1242, 'Yabancı dil', '', ''),
 (  3, N'İngilizce',   1, 1243, 'Yabancı dil', '', ''),
 (  4, N'Almanca',     1, 1244, 'Yabancı dil', '', ''),
 (  5, N'Fransızca',   1, 1245, 'Yabancı dil', '', ''),
 (  6, N'Farsça',      1, 1246, 'Yabancı dil', '', ''),
 (  7, N'Rusca',       1, 1247, 'Yabancı dil', '', '')


-- ------------------------------------------------------- 
-- OzelDurumuTipiId
-- ------------------------------------------------------- 
IF EXISTS (Select * From sys.objects WHERE name = 'MtskAdayTakipOzelDurumuTipi')
drop table [Lkp].[MtskAdayTakipOzelDurumuTipi]

create table [Lkp].[MtskAdayTakipOzelDurumuTipi]
(
   Id               Int Unique Not null,
   OzelDurumuTipi   nVarchar(60)   null,
   KonuGrupId       SmallInt       null,
   KonuId           Int            null,
   KonuCaption      nVarchar(20)   null,
   ChartCaption     nVarchar(20)   null,
   FormCaption      nVarchar(15)   null,

   constraint  pk_MtskAdayTakipOzelDurumuTipi primary key (Id)
)

Delete from [Lkp].[MtskAdayTakipOzelDurumuTipi]
INSERT INTO [Lkp].[MtskAdayTakipOzelDurumuTipi] (Id, OzelDurumuTipi, KonuGrupId, KonuId, KonuCaption, ChartCaption, FormCaption)
 VALUES 
  (  1, N'Özür durumu',          1, 1251, 'Özel durumu', '', ''),
  (  2, N'Okutman talebi',       1, 1252, 'Özel durumu', '', ''),
  (  3, N'Tercüman talebi',      1, 1253, 'Özel durumu', '', ''),
  (  4, N'Yabancı dil',          1, 1254, 'Özel durumu', '', ''),
  (  5, N'Yabancı uyruklar',     1, 1255, 'Özel durumu', '', ''),
  (  6, N'Etiketli kursiyerler', 1, 1256, 'Özel durumu', '', ''),
  (  7, N'Kontejan',             1, 1257, 'Özel durumu', '', '')


-- ------------------------------------------------------- 
-- BelgelerTipiId -- bu field MtskAdayTakip tablosunda yok
-- bazı koşulları takip için var
-- ------------------------------------------------------- 
IF EXISTS (Select * From sys.objects WHERE name = 'MtskAdayTakipBelgelerTipi')
drop table [Lkp].[MtskAdayTakipBelgelerTipi]

create table [Lkp].[MtskAdayTakipBelgelerTipi]
(
   Id                Int Unique not null, 
   BelgelerTipi      nVarchar(50)   null,
   KonuGrupId        SmallInt       null,
   KonuId            Int            null,
   KonuCaption       nVarchar(20)   null,
   ChartCaption      nVarchar(20)   null,
   FormCaption       nVarchar(30)   null,
   
   constraint  pk_MtskAdayTakipBelgelerTipi primary key (Id)
)
-- ------------------------------------------------------- 
-- 1261  BelgelerGeldi         /* tamamı geldiyse */
-- 1262  BelgelerTarandi       /* tamamı tarandıysa */
-- 1263  BelgelerYuklendi      /* tamamı yüklendiyse */
-- ------------------------------------------------------- 

Delete from [Lkp].[MtskAdayTakipBelgelerTipi]
INSERT INTO [Lkp].[MtskAdayTakipBelgelerTipi] (Id, BelgelerTipi, KonuGrupId, KonuId, KonuCaption, ChartCaption, FormCaption)
 VALUES 
  ( 1,  N'Belgeleri eksik olanlar',         1, 1261, 'Belgeler',  '', '' ),
  ( 2,  N'Belgeleri taranmayan',            1, 1262, 'Belgeler',  '', '' ),
  ( 3,  N'Belgeleri Mebbise yüklenmeyen',   1, 1263, 'Belgeler',  '', 'Mebbise bağlan ...' )


-- iptal edildi
-- ------------------------------------------------------- 
-- EgitimSureciTipiId : 1270
-- ------------------------------------------------------- 


-- ------------------------------------------------------- 
-- SertifikaUcretTipiId ipta
-- BorcDurumuTipiId
-- ------------------------------------------------------- 
IF EXISTS (Select * From sys.objects WHERE name = 'MtskAdayTakipBorcDurumuTipi')
drop table [Lkp].[MtskAdayTakipBorcDurumuTipi]

create table [Lkp].[MtskAdayTakipBorcDurumuTipi]
(
   Id               Int Unique not null, 
   BorcDurumuTipi   nVarchar(50)   null,
   KonuGrupId        SmallInt       null,
   KonuId            Int            null,
   KonuCaption       nVarchar(20)   null,
   ChartCaption      nVarchar(20)   null,
   FormCaption       nVarchar(30)   null,
   
   constraint  pk_MtskAdayTakipBorcDurumuTipi primary key (Id)
)

Delete from [Lkp].[MtskAdayTakipBorcDurumuTipi]
INSERT INTO [Lkp].[MtskAdayTakipBorcDurumuTipi] (Id, BorcDurumuTipi)
 VALUES 
  ( 0,    N'Hiç ödemesi yok'),
  ( 1,    N'Kısmi ödemesi var'),
  ( 2,    N'Gecikmiş ödemesi var'),
  ( 3,    N'Tamamı tahsil edildi'),
  ( 4,    N'Ücretsiz')


-- --------------------------------------------------------------------------------
--
-- Teorik Ders ve e-Sınavlar
--
-- --------------------------------------------------------------------------------

-- ------------------------------------------------------- 
-- TeorikDersTipiId
-- ------------------------------------------------------- 
IF EXISTS (Select * From sys.objects WHERE name = 'MtskAdayTakipTeorikDersTipi')
drop table [Lkp].[MtskAdayTakipTeorikDersTipi]

create table [Lkp].[MtskAdayTakipTeorikDersTipi]
(
   Id               Int Unique not null, 
   TeorikDersTipi   nVarchar(50)   null,
   KonuGrupId       SmallInt       null,
   KonuId           Int            null,
   KonuCaption      nVarchar(20)   null,
   ChartCaption     nVarchar(20)   null,
   FormCaption      nVarchar(15)   null,
   
   constraint  pk_MtskAdayTakipTeorikDersTipi primary key (Id)
)

-- Bu Id prc_MtskAdayTakipTeorikDersSet taraffından set ediliyor 
Delete from [Lkp].[MtskAdayTakipTeorikDersTipi]
INSERT INTO [Lkp].[MtskAdayTakipTeorikDersTipi] (Id, TeorikDersTipi, KonuGrupId, KonuId, KonuCaption, ChartCaption, FormCaption)
 VALUES 
  ( 0,  N'Tanımsız',                                      1, 2100, 'Teorik ders', '', ''),
  ( 1,  N'Teorik ders planı yok',                         1, 2101, 'Teorik ders', '', ''),
  ( 2,  N'Teorik ders planı eksik',                       1, 2102, 'Teorik ders', '', ''),
  ( 3,  N'Teorik ders planı mevcut',                      1, 2103, 'Teorik ders', '', ''),
  ( 6,  N'Muaf',                                          1, 2106, 'Teorik ders', '', ''),
  ( 11, N'Grup başlangıç tarihi belli değil',             1, 2111, 'Teorik ders', '', ''),
  ( 12, N'Teorik dersler planlanacak',                    1, 2112, 'Teorik ders', '', ''),
  ( 13, N'Teorik dersler planlandı, Mebbise aktarılacak', 1, 2113, 'Teorik ders', '', ''),
  ( 14, N'Teorik dersler Mebbise aktarıldı',              1, 2114, 'Teorik ders', '', ''),
  ( 15, N'Teorik dersler başlamadı',                      1, 2115, 'Teorik ders', '', ''),
  ( 16, N'Teorik dersler başladı',                        1, 2116, 'Teorik ders', '', ''),
  ( 17, N'Teorik dersler tamamlandı',                     1, 2117, 'Teorik ders', '', '')

-- ------------------------------------------------------- 
-- eSinavDurumTipiId
-- ------------------------------------------------------- 
IF EXISTS (Select * From sys.objects WHERE name = 'MtskAdayTakipeSinavDurumTipi')
drop table [Lkp].[MtskAdayTakipeSinavDurumTipi]

create table [Lkp].[MtskAdayTakipeSinavDurumTipi]
(
   Id               Int Unique not null, 
   eSinavDurumTipi  nVarchar(50)   null,
   KonuGrupId       SmallInt       null,
   KonuId           Int            null,
   KonuCaption      nVarchar(20)   null,
   ChartCaption     nVarchar(20)   null,
   FormCaption      nVarchar(15)   null,
   
   constraint  pk_MtskAdayTakipeSinavDurumTipi primary key (Id)
)

Delete from [Lkp].[MtskAdayTakipeSinavDurumTipi]
INSERT INTO [Lkp].[MtskAdayTakipeSinavDurumTipi] (Id, eSinavDurumTipi, KonuGrupId, KonuId, KonuCaption, ChartCaption, FormCaption)--  , ChartCaption, FormCaption)
 VALUES 
  ( 0,    N'Tanımsız',                    1, 2120, 'Sınav durumu', '', '' ),
  ( 1,    N'e-Sınav için hazır değil',    1, 2121, 'Sınav durumu', 'Hazır değil', '' ),              -- default
  ( 2,    N'e-Sınav başvurusu yapılacak', 1, 2122, 'Sınav durumu', 'Başvuru yapılacak', 'Mebbis' ),  -- TeorikDersTipiId tetikleyecek
  ( 3,    N'e-Sınav başvurusu yapıldı',   1, 2123, 'Sınav durumu', 'Başvuru yapıldı', '' ),          -- kullanıcı tetikliyor, başvuru kontrolü ?
  ( 4,    N'e-Sınav sonucu okunacak',     1, 2124, 'Sınav durumu', 'Sınav okunacak', 'Mebbis.' ),    -- sınav günü gelince bu ıd olmalı
  ( 5,    N'e-Sınav sonucu okundu',       1, 2125, 'Sınav durumu', 'Sınav okundu', '' ),             -- kullanıcı okuttuktan sonra
  ( 6,    N'Muaf',                        1, 2126, 'Sınav durumu', 'Muaf', '' )                      -- 


-- ------------------------------------------------------- 
-- eSinavSonucTipiId
-- ------------------------------------------------------- 
IF EXISTS (Select * From sys.objects WHERE name = 'MtskAdayTakipeSinavSonucTipi')
drop table [Lkp].[MtskAdayTakipeSinavSonucTipi]

create table [Lkp].[MtskAdayTakipeSinavSonucTipi]
(
   Id               Int Unique not null, 
   eSinavSonucTipi  nVarchar(50)   null,
   KonuGrupId       SmallInt       null,
   KonuId           Int            null,
   KonuCaption      nVarchar(20)   null,
   ChartCaption     nVarchar(20)   null,
   FormCaption      nVarchar(15)   null,
   
   constraint  pk_MtskAdayTakipeSinavSonucTipi primary key (Id)
)

Delete from [Lkp].[MtskAdayTakipeSinavSonucTipi]
INSERT INTO [Lkp].[MtskAdayTakipeSinavSonucTipi] (Id, eSinavSonucTipi, KonuGrupId, KonuId, KonuCaption, ChartCaption, FormCaption) --, ChartCaption, FormCaption)
 VALUES 
  ( 0,    N'Tanımsız',                    1, 2130, 'Sınav sonucu', '', '' ),
  ( 1,    N'Başarılı',                    1, 2131, 'Sınav sonucu', 'Başarılı', ''),
  ( 2,    N'Başarısız',                   1, 2132, 'Sınav sonucu', 'Başarısız', ''),
  ( 3,    N'Girmedi',                     1, 2133, 'Sınav sonucu', 'Girmedi', ''),
  ( 4,    N'Raporlu',                     1, 2134, 'Sınav sonucu', 'Raporlu', ''),
  ( 5,    N'İptal Edildi(Sınav Yasaklı)', 1, 2135, 'Sınav sonucu', 'İptal', '')

-- ------------------------------------------------------- 
-- eSinavSonrasiTipiId
-- ------------------------------------------------------- 
IF EXISTS (Select * From sys.objects WHERE name = 'MtskAdayTakipeSinavSonrasiTipi')
drop table [Lkp].[MtskAdayTakipeSinavSonrasiTipi]

create table [Lkp].[MtskAdayTakipeSinavSonrasiTipi]
(
   Id                 Int Unique not null, 
   eSinavSonrasiTipi  nVarchar(50)   null,
   KonuGrupId         SmallInt       null,
   KonuId             Int            null,
   KonuCaption        nVarchar(20)   null,
   ChartCaption       nVarchar(20)   null,
   FormCaption        nVarchar(15)   null,   

   constraint  pk_MtskAdayTakipeSinavSonrasıTipi primary key (Id)
)

Delete from [Lkp].[MtskAdayTakipeSinavSonrasiTipi]
INSERT INTO [Lkp].[MtskAdayTakipeSinavSonrasiTipi] (Id, eSinavSonrasiTipi, KonuGrupId, KonuId, KonuCaption, ChartCaption, FormCaption) --, ChartCaption, FormCaption)
 VALUES 
  ( 0,    N'Tanımsız',                 1, 2140, 'Sınav sonrası', '', '' ),
  ( 1,    N'Tekrar sınava girecek',    1, 2141, 'Sınav sonrası', 'Tekrar sınav', '' ),
  ( 2,    N'Uygulama aşamasına geçti', 1, 2142, 'Sınav sonrası', 'Uyg. aşama. geçti', '' ),
  ( 3,    N'Tüm e-Sınav hakkı bitti',  1, 2143, 'Sınav sonrası', 'Sınav hakkı bitti', '' )

-- ------------------------------------------------------- 
-- eSinavUcretTipiId
-- ------------------------------------------------------- 
IF EXISTS (Select * From sys.objects WHERE name = 'MtskAdayTakipeSinavUcretTipi')
drop table [Lkp].[MtskAdayTakipeSinavUcretTipi]

create table [Lkp].[MtskAdayTakipeSinavUcretTipi]
(
   Id               Int Unique not null, 
   eSinavUcretTipi  nVarchar(50)   null,
   KonuGrupId       SmallInt       null,
   KonuId           Int            null,
   KonuCaption      nVarchar(20)   null,
   ChartCaption     nVarchar(20)   null,
   FormCaption      nVarchar(15)   null,   
   
   constraint  pk_MtskAdayTakipeSinavUcretTipi primary key (Id)
)

Delete from [Lkp].[MtskAdayTakipeSinavUcretTipi]
INSERT INTO [Lkp].[MtskAdayTakipeSinavUcretTipi] (Id, eSinavUcretTipi, KonuGrupId, KonuId, KonuCaption, ChartCaption, FormCaption)
 VALUES 
  ( 0,    N'Tanımsız',                 1, 2150, 'Sınav ücreti', '', ''),
  ( 1,    N'Biz yatıracağız',          1, 2151, 'Sınav ücreti', '', ''),
  ( 2,    N'Adayın kendisi yatıracak', 1, 2152, 'Sınav ücreti', '', '')



-- --------------------------------------------------------------------------------
--
-- Uygulamalı Dersler ve Uygulamalı Sınavlar
--
-- --------------------------------------------------------------------------------

-- ------------------------------------------------------- 
-- UygulamaliDersTipiId
-- ------------------------------------------------------- 
IF EXISTS (Select * From sys.objects WHERE name = 'MtskAdayTakipUygulamaliDersTipi')
drop table [Lkp].[MtskAdayTakipUygulamaliDersTipi]

create table [Lkp].[MtskAdayTakipUygulamaliDersTipi]
(
   Id                  Int Unique not null, 
   UygulamaliDersTipi  nVarchar(60)   null,
   KonuGrupId          SmallInt       null,
   KonuId              Int            null,
   KonuCaption         nVarchar(20)   null,
   ChartCaption        nVarchar(20)   null,
   FormCaption         nVarchar(15)   null,   
   
   constraint  pk_MtskAdayTakipUygulamaliDersTipi primary key (Id)
)

Delete from [Lkp].[MtskAdayTakipUygulamaliDersTipi]
INSERT INTO [Lkp].[MtskAdayTakipUygulamaliDersTipi] (Id, UygulamaliDersTipi, KonuGrupId, KonuId, KonuCaption, ChartCaption, FormCaption)
 VALUES 
  ( 0,    N'Tanımsız',                                                 1, 3100, 'Uygulamalı dersler', '', '' ),
  ( 1,    N'Uygulamalı dersler planlanacak',                           1, 3101, 'Uygulamalı dersler', 'Planlanacak', 'Planlama' ),
  ( 2,    N'Uygulamalı dersler planlandı, Mebbise aktarılacak',        1, 3102, 'Uygulamalı dersler', 'Planlandı', 'Mebbis' ),
  ( 3,    N'Uygulamalı dersler Mebbise aktarıldı, dersler başlamadı',  1, 3103, 'Uygulamalı dersler', 'Planlandı', '' ),
  ( 4,    N'Uygulamalı dersleri başladı',                              1, 3104, 'Uygulamalı dersler', 'Ders alıyor', '' ),
  ( 5,    N'Uygulamalı dersleri tamamladı',                            1, 3105, 'Uygulamalı dersler', 'Ders tamamlandı', '' )

-- ------------------------------------------------------- 
-- BasarisizDersTipiId
-- ------------------------------------------------------- 
IF EXISTS (Select * From sys.objects WHERE name = 'MtskAdayTakipBasarisizDersTipi')
drop table [Lkp].[MtskAdayTakipBasarisizDersTipi]

create table [Lkp].[MtskAdayTakipBasarisizDersTipi]
(
   Id                  Int Unique not null, 
   BasarisizDersTipi   nVarchar(60)   null,
   KonuGrupId          SmallInt       null,
   KonuId              Int            null,
   KonuCaption         nVarchar(30)   null,
   ChartCaption        nVarchar(20)   null,
   FormCaption         nVarchar(15)   null,   
   
   constraint  pk_MtskAdayTakipBasarisizDersTipi primary key (Id)
)

Delete from [Lkp].[MtskAdayTakipBasarisizDersTipi]
INSERT INTO [Lkp].[MtskAdayTakipBasarisizDersTipi] (Id, BasarisizDersTipi, KonuGrupId, KonuId, KonuCaption, ChartCaption, FormCaption)
 VALUES 
  ( 0,    N'Tanımsız',                                                     1, 3120, 'Başarısız aday eğitimi',  '', ''),
  ( 1,    N'2 saat başarısız aday eğitimi planlanacak',                    1, 3121, 'Başarısız aday eğitimi', '2 saat planlanacak', 'Planlama.' ),
  ( 2,    N'2 saat başarısız aday eğitimi planlandı, Mebbise aktarılacak', 1, 3122, 'Başarısız aday eğitimi', '2 saat planlandı', 'Mebbis.' ),
  ( 3,    N'2 saat başarısız aday eğitimi Mebbise aktarıldı, başlamadı',   1, 3123, 'Başarısız aday eğitimi', '2 saat planlandı', '' ),
  ( 4,    N'2 saat başarısız aday eğitimi alıyor',                         1, 3124, 'Başarısız aday eğitimi', '2 saat eğitim alıyor', '' ),
  ( 5,    N'2 saat başarısız aday eğitimi tamamlandı',                     1, 3125, 'Başarısız aday eğitimi', '2 saat eğitim tamam', '' ),
  ( 6,    N'Eğitime gerek yok (Sınava girmedi)',                           1, 3126, 'Başarısız aday eğitimi', 'Sınava girmedi', '' )


-- ------------------------------------------------------- 
-- Arti4DersTipiId
-- ------------------------------------------------------- 
IF EXISTS (Select * From sys.objects WHERE name = 'MtskAdayTakipArti4DersTipi')
drop table [Lkp].[MtskAdayTakipArti4DersTipi]

create table [Lkp].[MtskAdayTakipArti4DersTipi]
(
   Id              Int Unique not null, 
   Arti4DersTipi   nVarchar(60)   null,
   KonuGrupId      SmallInt       null,
   KonuId          Int            null,
   KonuCaption     nVarchar(20)   null,
   ChartCaption    nVarchar(20)   null,
   FormCaption     nVarchar(15)   null,   
   
   constraint  pk_MtskAdayTakipArti4DersTipi primary key (Id)
)

Delete from [Lkp].[MtskAdayTakipArti4DersTipi]
INSERT INTO [Lkp].[MtskAdayTakipArti4DersTipi] (Id, Arti4DersTipi, KonuGrupId, KonuId, KonuCaption, ChartCaption, FormCaption)
 VALUES 
  ( 0,    N'Tanımsız',                                                1, 3130, '2. +4 hak eğitimi', '', ''),
  ( 1,    N'2. +4 hak dersleri planlanacak',                          1, 3131, '2. +4 hak eğitimi', '+4 planlanacak', 'Planlama' ),
  ( 2,    N'2. +4 hak dersleri planlandı, Mebbise aktarılacak',       1, 3132, '2. +4 hak eğitimi', '+4 planlandı', 'Mebbis' ),
  ( 3,    N'2. +4 hak dersleri Mebbise aktarıldı, derler başlamadı',  1, 3133, '2. +4 hak eğitimi', '+4 planlandı', 'Mebbis' ),
  ( 4,    N'2. +4 hak dersleri başladı',                              1, 3134, '2. +4 hak eğitimi', '+4 alıyor', '' ),
  ( 5,    N'2. +4 hak dersleri tamamlandı',                           1, 3135, '2. +4 hak eğitimi', '+4 tamamlandı', '' )



-- ------------------------------------------------------- 
-- PlanlanacakEgitimTipiId
-- ------------------------------------------------------- 
IF EXISTS (Select * From sys.objects WHERE name = 'MtskAdayTakipPlanlanacakEgitimTipi')
drop table [Lkp].[MtskAdayTakipPlanlanacakEgitimTipi]

create table Lkp.MtskAdayTakipPlanlanacakEgitimTipi
(
   Id                      Int Unique Not Null,
   PlanlanacakEgitimTipi   nVarchar(50)   null,
   KonuGrupId       SmallInt       null,
   KonuId           Int            null,
   KonuCaption      nVarchar(20)   null,
   ChartCaption     nVarchar(25)   null,
   FormCaption      nVarchar(15)   null,   

   constraint  pk_MtskAdayTakipPlanlanacakEgitimTipi primary key (Id)
)

Delete from Lkp.MtskAdayTakipPlanlanacakEgitimTipi
INSERT INTO Lkp.MtskAdayTakipPlanlanacakEgitimTipi (Id, PlanlanacakEgitimTipi)
 VALUES 
  ( 0, N''),
  ( 1, N'Normal Eğitim'),
  ( 2, N'Telafi Eğitim(Ön Sınav )'),
  ( 3, N'2.Direksiyon Eğitimi'),
  ( 4, N'Başarısız Aday Eğitimi')



-- ------------------------------------------------------- 
-- uSinavDurumTipiId
-- ------------------------------------------------------- 
IF EXISTS (Select * From sys.objects WHERE name = 'MtskAdayTakipuSinavDurumTipi')
drop table [Lkp].[MtskAdayTakipuSinavDurumTipi]

create table [Lkp].[MtskAdayTakipuSinavDurumTipi]
(
   Id               Int Unique not null, 
   uSinavDurumTipi  nVarchar(60)   null,
   KonuGrupId       SmallInt       null,
   KonuId           Int            null,
   KonuCaption      nVarchar(20)   null,
   ChartCaption     nVarchar(25)   null,
   FormCaption      nVarchar(15)   null,   
      
   constraint  pk_MtskAdayTakipuSinavDurumTipi primary key (Id)
)

Delete from [Lkp].[MtskAdayTakipuSinavDurumTipi]
INSERT INTO [Lkp].[MtskAdayTakipuSinavDurumTipi] (Id, uSinavDurumTipi, KonuGrupId, KonuId, KonuCaption, ChartCaption, FormCaption)
 VALUES 
  ( 0,    N'Tanımsız',                                           1, 3140, 'Sınav durumu', '', '' ),
  ( 1,    N'Henüz sınav aşamasında değil',                       1, 3141, 'Sınav durumu', '', '' ),
  ( 2,    N'Uygulama sınavı için usta öğretici onayı isteniyor', 1, 3142, 'Sınav durumu', '', 'Onayla' ),
  ( 3,    N'Uygulama sınavı için hazır değil',                   1, 3143, 'Sınav durumu', 'Uyg.hazır değil', '' ),
  ( 4,    N'Uygulama sınavı için MEBBİS de onaylanacak',         1, 3144, 'Sınav durumu', 'Mebbisde onaylanacak', 'Mebbis' ),
  ( 5,    N'Uygulama sınav randevusu planlanacak',               1, 3145, 'Sınav durumu', 'Randevu planlanacak', 'Planlama' ),
  ( 6,    N'Uygulama sınav randevusu MEBBİSe aktarılacak',       1, 3146, 'Sınav durumu', 'Randevu mebbise aktar', 'Mebbis.' ),
  ( 7,    N'Uygulama sınavına girecek',                          1, 3147, 'Sınav durumu', 'Sınava girecek', '' ),
  ( 8,    N'Uygulama sınav sonucu okunacak',                     1, 3148, 'Sınav durumu', 'Sonuç okunacak', 'Mebbis..' ),
  ( 9,    N'Uygulama sınav sonucu okundu',                       1, 3149, 'Sınav durumu', 'Sonuç okundu', '' )


-- ------------------------------------------------------- 
-- uSinavaHazirmiTipiId
-- ------------------------------------------------------- 
IF EXISTS (Select * From sys.objects WHERE name = 'MtskAdayTakipuSinavaHazirmiTipi')
drop table [Lkp].[MtskAdayTakipuSinavaHazirmiTipi]

create table [Lkp].[MtskAdayTakipuSinavaHazirmiTipi]
(
   Id                  Int Unique not null, 
   uSinavaHazirmiTipi  nVarchar(50)   null,
   KonuGrupId          SmallInt       null,
   KonuId              Int            null,
   KonuCaption         nVarchar(20)   null,
   ChartCaption        nVarchar(20)   null,
   FormCaption         nVarchar(15)   null,
   
   constraint  pk_MtskAdayTakipuSinavaHazirmiTipi primary key (Id)
)

Delete from [Lkp].[MtskAdayTakipuSinavaHazirmiTipi]
INSERT INTO [Lkp].[MtskAdayTakipuSinavaHazirmiTipi] (Id, uSinavaHazirmiTipi, KonuGrupId, KonuId, KonuCaption, ChartCaption, FormCaption)
 VALUES 
  ( 0,    N'Sınava hazır mı ?',              1, 3150, 'Sınava hazır mı', '', ''),
  ( 1,    N'Evet - Sınava hazır',            1, 3151, 'Sınava hazır mı', '', ''),
  ( 2,    N'Hayır - Sınav için hazır değil', 1, 3152, 'Sınava hazır mı', '', ''),
  ( 3,    N'Takviye derslerle sınava hazır', 2, 3153, 'Sınava hazır mı', '', '')


-- ------------------------------------------------------- 
-- uSinavSonucTipiId
-- ------------------------------------------------------- 
IF EXISTS (Select * From sys.objects WHERE name = 'MtskAdayTakipuSinavSonucTipi')
drop table [Lkp].[MtskAdayTakipuSinavSonucTipi]

create table [Lkp].[MtskAdayTakipuSinavSonucTipi]
(
   Id               Int Unique not null, 
   uSinavSonucTipi  nVarchar(50)   null,
   KonuGrupId       SmallInt       null,
   KonuId           Int            null,
   KonuCaption      nVarchar(20)   null,
   ChartCaption     nVarchar(20)   null,
   FormCaption      nVarchar(15)   null,   
   
   constraint  pk_MtskAdayTakipuSinavSonucTipi primary key (Id)
)

Delete from [Lkp].[MtskAdayTakipuSinavSonucTipi]
INSERT INTO [Lkp].[MtskAdayTakipuSinavSonucTipi] (Id, uSinavSonucTipi, KonuGrupId, KonuId, KonuCaption, ChartCaption, FormCaption)
 VALUES 
  ( 0,    N'Tanımsız',  1, 3160, 'Sınav sonucu', '' ,'' ),
  ( 1,    N'Başarılı',  1, 3161, 'Sınav sonucu', 'Başarılı' ,'' ),
  ( 2,    N'Başarısız', 1, 3162, 'Sınav sonucu', 'Başarısız' ,'' ),
  ( 3,    N'Girmedi',   1, 3163, 'Sınav sonucu', 'Girmedi' ,'' )
  
-- ------------------------------------------------------- 
-- uSinavSonrasiTipiId
-- ------------------------------------------------------- 
IF EXISTS (Select * From sys.objects WHERE name = 'MtskAdayTakipuSinavSonrasiTipi')
drop table [Lkp].[MtskAdayTakipuSinavSonrasiTipi]

create table [Lkp].[MtskAdayTakipuSinavSonrasiTipi]
(
   Id                 Int Unique not null, 
   uSinavSonrasiTipi  nVarchar(100)  null,
   KonuGrupId         SmallInt       null,
   KonuId             Int            null,
   KonuCaption        nVarchar(20)   null,
   ChartCaption       nVarchar(20)   null,
   FormCaption        nVarchar(15)   null, 
   
   constraint  pk_MtskAdayTakipuSinavSonrasıTipi primary key (Id)
)

Delete from [Lkp].[MtskAdayTakipuSinavSonrasiTipi]
INSERT INTO [Lkp].[MtskAdayTakipuSinavSonrasiTipi] (Id, uSinavSonrasiTipi, KonuGrupId, KonuId, KonuCaption, ChartCaption, FormCaption)
 VALUES 
  ( 0,    N'Tanımsız',                            1, 3170, 'Sınav sonrası', '', '' ),
  ( 1,    N'Sınava tekrar girecek',               1, 3171, 'Sınav sonrası', 'Tekrar girecek', '' ),
  ( 2,    N'Sertifika aşamasına geçti',           1, 3172, 'Sınav sonrası', 'Sertifikayı kazandı', '' ),
  ( 3,    N'Tüm uygulamalı sınav hakkı bitti',    1, 3173, 'Sınav sonrası', 'Sınav hakkı bitti', '' ),
  ( 4,    N'2. +4 sınav hakkı bitti',             1, 3174, 'Sınav sonrası', '2.+4 sınav hak bitti', '' ),
  ( 5,    N'Sınava giren toplam kursiyer sayısı', 1, 3175, 'Sınav sonrası', 'Toplam kursiyer', '' )


-- ------------------------------------------------------- 
-- uSinavUcretTipiId
-- ------------------------------------------------------- 
IF EXISTS (Select * From sys.objects WHERE name = 'MtskAdayTakipuSinavUcretTipi')
drop table [Lkp].[MtskAdayTakipuSinavUcretTipi]

create table [Lkp].[MtskAdayTakipuSinavUcretTipi]
(
   Id               Int Unique not null, 
   uSinavUcretTipi  nVarchar(50)   null,
   KonuGrupId       SmallInt       null,
   KonuId           Int            null,
   KonuCaption      nVarchar(20)   null,
   ChartCaption     nVarchar(20)   null,
   FormCaption      nVarchar(15)   null, 
   
   constraint  pk_MtskAdayTakipuSinavUcretTipi primary key (Id)
)

Delete from [Lkp].[MtskAdayTakipuSinavUcretTipi]
INSERT INTO [Lkp].[MtskAdayTakipuSinavUcretTipi] (Id, uSinavUcretTipi, KonuGrupId, KonuId, KonuCaption, ChartCaption, FormCaption)
 VALUES 
  ( 0,    N'Tanımsız',                 1, 3180, 'Sınav ücreti', '', '' ),
  ( 1,    N'Biz yatıracağız',          1, 3181, 'Sınav ücreti', '', '' ),
  ( 2,    N'Adayın kendisi yatıracak', 1, 3182, 'Sınav ücreti', '', '' )


-- ------------------------------------------------------- 
--
-- SertifikaDurumTipiId
--
-- ------------------------------------------------------- 


IF EXISTS (Select * From sys.objects WHERE name = 'MtskAdayTakipSertifikaDurumTipi')
drop table [Lkp].[MtskAdayTakipSertifikaDurumTipi]

create table [Lkp].[MtskAdayTakipSertifikaDurumTipi]
(
   Id                 Int Unique not null, 
   SertifikaDurumTipi nVarchar(50)   null,
   KonuGrupId         SmallInt       null,
   KonuId             Int            null,
   KonuCaption        nVarchar(20)   null,
   ChartCaption       nVarchar(20)   null,
   FormCaption        nVarchar(15)   null,
   
   constraint  pk_MtskAdayTakipSertifikaDurumTipi primary key (Id)
)

Delete from [Lkp].[MtskAdayTakipSertifikaDurumTipi]
INSERT INTO [Lkp].[MtskAdayTakipSertifikaDurumTipi] (Id, SertifikaDurumTipi, KonuGrupId, KonuId, KonuCaption, ChartCaption, FormCaption)
 VALUES 
  ( 0,    N'Tanımsız',                                     1, 4110, 'Sertifika işlemleri',  '', '' ),
  ( 1,    N'Sertifikası hazırlanacak (Seri No verilecek)', 1, 4111, 'Sertifika işlemleri', 'Sert. hazırlanacak', '' ),
  ( 2,    N'Sertifika formu yazdırılacak',                 1, 4112, 'Sertifika işlemleri', 'Sert. formu yaz', '' ),
  ( 3,    N'Sertifikası hazır',                            1, 4113, 'Sertifika işlemleri', 'Sert. hazır', '' ),
  ( 4,    N'Sertifikası teslim edildi',                    1, 4114, 'Sertifika işlemleri', 'Sert. teslim edildi', '' )


commit transaction

/*CreateLkpTableEnd*/


/*

   KonuGrupId  = 1 : Aday kayıtları
   -----------------------------------------
 1110  TalepTipiId            SmallInt     null, /* 1. sertifika, 2. (2.+4 hak), 3. Nakil 2.+4hak, 4. 100Ceza, 5. Özel Uyg Ders   */ 
 1120  KayitTipiId            SmallInt     null, /* trg_MtskAday : 1. Ön kayıt, 2. Kayıt aşamasında, 3. Kesin Kayıt ...  */ 
 1130  ZamanlamaTipiId        SmallInt     null, /* detay aşağıda */
 1140  IsGrupSubeYok          Bit          null, /* grup veya şubesi belli değilse  */
 1150  IsActive               Bit          null, /* eğitim devam edenler = 1, değilse = 0 : sorgularda kolaylık olsun diye var (IsEgitimDevamEdiyor) */ 
 1160  MebbisKurumOnayi       Bit          null, /* trg_MtskAday : 0-Onaysız, 1-Onaylandı */	
 1170  MebbisDurumTipiId      SmallInt     null, /* trg_MtskAday :  detay aşağıda */
 1210  YasOnayiTipiId         SmallInt     null, /* 1-Yaşı Tutmuyor, 2-Yaşı Tutuyor, 3. Diğer sebeplerle onaylı */
 1220  DeneyimSartiTipiId     SmallInt     null, /*  MtskSaatUygulama dan okunacak  */       

 1230   OzurDurumTipiId        SmallInt     null, /* MtskAdaySaglik tan gelecek bilgi  */
 1241   BelgelerGeldi          Bit          null, /* tamamı geldiyse */
 1242   BelgelerTarandi        Bit          null, /* tamamı tarandıysa */
 1243   BelgelerYuklendi       Bit          null, /* tamamı yüklendiyse */
 1270   EgitimSureciTipiId     SmallInt     null, /* detay aşağıda */

   BorcDurumuTipiId         SmallInt     null,


   KonuGrupId  = 2 : Dönem grup şube
   -----------------------------------------


   KonuGrupId  = 3 : Teorik dersler
   -----------------------------------------

   KonuGrupId  = 4 : e-Sınav süreci
   -----------------------------------------


   KonuGrupId  = 5 : uygulamalı dersler
   -----------------------------------------


   KonuGrupId  = 6 : uygulamalı sınavlar
   -----------------------------------------


   KonuGrupId  = 7 : sertifika süreci
   -----------------------------------------


   KonuGrupId  = 8 : aday listesi ve borçları
   -----------------------------------------





*/


/*CreateTrigger*/



CREATE TRIGGER [dbo].[trg_MtskAdayTakip] on [dbo].[MtskAdayTakip]
AFTER INSERT, UPDATE
AS BEGIN

    DECLARE takipCursor cursor local for select Id from Inserted
    DECLARE @takipId bigint

    OPEN takipCursor
    FETCH NEXT FROM takipCursor INTO @takipId

    -- Veri Transferi başladımı
    declare @DbUpdatesIsActive Bit = 0
    set @DbUpdatesIsActive = [dbo].[fnc_getIsDbUpdate] (13)

    declare @TalepId int = 0
	declare @AdayId int
    declare @FirmId int
	
    declare @yuSinavaHazirmiTipiId smallInt 
    declare @yuSinavDurumTipiId smallInt
    declare @yIsUygSinavMebbisOnayi bit 
    declare @yIsRandevuPlanlandi bit
    declare @yIsRandevuMebbis bit

    declare @euSinavaHazirmiTipiId smallInt 
    declare @euSinavDurumTipiId smallInt
    declare @eIsUygSinavMebbisOnayi bit 
    declare @eIsRandevuPlanlandi bit
    declare @eIsRandevuMebbis bit

    WHILE @@FETCH_STATUS = 0
    BEGIN
	
        select 
		    @euSinavaHazirmiTipiId = isnull(dlt.uSinavaHazirmiTipiId,0)
           ,@euSinavDurumTipiId = isnull(dlt.uSinavDurumTipiId,0)
           ,@eIsUygSinavMebbisOnayi = isnull(dlt.IsUygSinavMebbisOnayi,0)
           ,@eIsRandevuPlanlandi = isnull(dlt.IsRandevuPlanlandi,0)
           ,@eIsRandevuMebbis = isnull(dlt.IsRandevuMebbis,0)

		from deleted dlt
    	where dlt.Id = @takipId

        select 
            @FirmId  = ins.FirmId
           ,@TalepId = ins.TalepId
           ,@AdayId = ins.AdayId
		   ,@yuSinavaHazirmiTipiId = isnull(ins.uSinavaHazirmiTipiId,0)
           ,@yuSinavDurumTipiId = isnull(ins.uSinavDurumTipiId,0)
           ,@yIsUygSinavMebbisOnayi = isnull(ins.IsUygSinavMebbisOnayi,0)
           ,@yIsRandevuPlanlandi = isnull(ins.IsRandevuPlanlandi,0)
           ,@yIsRandevuMebbis = isnull(ins.IsRandevuMebbis,0)

		from inserted ins
    	where ins.Id = @takipId
		
		
        if (@DbUpdatesIsActive = 0)
        begin 
            if (@euSinavaHazirmiTipiId = 2 and  -- eski kayıt hazır değilse
			    @yuSinavaHazirmiTipiId = 1 )    -- yeni kayıt hazır ise
            begin 
                -- 2 > 1 olamaz
				-- 2 > 3 olabilir
                -- 1, Sınava hazır
                -- 2, Sınav için hazır değil
                -- 3, Takviye derslerle sınava hazır
                update MtskAdayTakip set uSinavaHazirmiTipiId = 3
                Where TalepId = @TalepId
			end

			if ((@euSinavaHazirmiTipiId <> @yuSinavaHazirmiTipiId) or
			    (@euSinavDurumTipiId <> @yuSinavDurumTipiId) or
                (@eIsUygSinavMebbisOnayi <> @yIsUygSinavMebbisOnayi) or
                (@eIsRandevuPlanlandi <> @yIsRandevuPlanlandi) or
                (@eIsRandevuMebbis <> @yIsRandevuMebbis)
               )
			    exec dbo.prc_MtskAdayTakip @FirmId

        end	-- 	@DbUpdatesIsActive = 0


        FETCH NEXT FROM takipCursor INTO @takipId
    END -- While

    CLOSE takipCursor
    DEALLOCATE takipCursor   


END -- create trigger



/*CreateTriggerEnd*/

