
/*CreateProcedure*/

CREATE PROCEDURE [dbo].[prc_MtskAdayTakipUygulamaToplamlari] (@FirmId int)  
AS BEGIN

 --declare @FirmId int = 30

-- UygulamaliDersTipi
Select 
   tip.KonuId
 , tip.KonuCaption   
 , tip.UygulamaliDersTipi as KonuAciklama
 , tip.FormCaption as Islem
 , count(takip.Id) as AdaySayisi 

From MtskAdayTakip as takip
     left outer join Lkp.MtskAdayTakipUygulamaliDersTipi as tip on 
	   ( takip.UygulamaliDersTipiId = tip.Id )
Where FirmId = @FirmId

Group by 
   tip.KonuId
 , tip.KonuCaption   
 , tip.UygulamaliDersTipi
 , tip.FormCaption 

union all

-- BasarisizDersTipi
Select 
   tip.KonuId
 , tip.KonuCaption   
 , tip.BasarisizDersTipi as KonuAciklama
 , tip.FormCaption as Islem
 , count(takip.Id) as AdaySayisi 

From MtskAdayTakip as takip
     left outer join Lkp.MtskAdayTakipBasarisizDersTipi as tip on 
	   ( takip.BasarisizDersTipiId = tip.Id )
Where FirmId = @FirmId

Group by 
   tip.KonuId
 , tip.KonuCaption   
 , tip.BasarisizDersTipi
 , tip.FormCaption 

union all

-- Arti4Tipi
Select 
   tip.KonuId
 , tip.KonuCaption   
 , tip.Arti4DersTipi as KonuAciklama
 , tip.FormCaption as Islem
 , count(takip.Id) as AdaySayisi 

From MtskAdayTakip as takip
     left outer join Lkp.MtskAdayTakipArti4DersTipi as tip on 
	   ( takip.BasarisizDersTipiId = tip.Id )
Where FirmId = @FirmId

Group by 
   tip.KonuId
 , tip.KonuCaption   
 , tip.Arti4DersTipi
 , tip.FormCaption 

union all

-- uSinavDurumTipi
Select 
   tip.KonuId
 , tip.KonuCaption   
 , tip.uSinavDurumTipi as KonuAciklama
 , tip.FormCaption as Islem
 , count(takip.Id) as AdaySayisi 

From MtskAdayTakip as takip
     left outer join Lkp.MtskAdayTakipuSinavDurumTipi as tip on 
	   ( takip.uSinavDurumTipiId = tip.Id )
Where FirmId = @FirmId

Group by 
   tip.KonuId
 , tip.KonuCaption   
 , tip.uSinavDurumTipi
 , tip.FormCaption 

union all

-- uSinavSonucTipi
Select 
   tip.KonuId
 , tip.KonuCaption   
 , tip.uSinavSonucTipi as KonuAciklama
 , tip.FormCaption as Islem
 , count(takip.Id) as AdaySayisi 

From MtskAdayTakip as takip
     left outer join Lkp.MtskAdayTakipuSinavSonucTipi as tip on 
	   ( takip.uSinavSonucTipiId = tip.Id )
Where FirmId = @FirmId

Group by 
   tip.KonuId
 , tip.KonuCaption   
 , tip.uSinavSonucTipi
 , tip.FormCaption 

union all

-- uSinavSonrasiTipi
Select 
   tip.KonuId
 , tip.KonuCaption   
 , tip.uSinavSonrasiTipi as KonuAciklama
 , tip.FormCaption as Islem
 , count(takip.Id) as AdaySayisi 

From MtskAdayTakip as takip
     left outer join Lkp.MtskAdayTakipuSinavSonrasiTipi as tip on 
	   ( takip.uSinavSonrasiTipiId = tip.Id )
Where FirmId = @FirmId

Group by 
   tip.KonuId
 , tip.KonuCaption   
 , tip.uSinavSonrasiTipi
 , tip.FormCaption 

union all

-- uSinavUcretTipi
Select 
   tip.KonuId
 , tip.KonuCaption   
 , tip.uSinavUcretTipi as KonuAciklama
 , tip.FormCaption as Islem
 , count(takip.Id) as AdaySayisi 

From MtskAdayTakip as takip
     left outer join Lkp.MtskAdayTakipuSinavUcretTipi as tip on 
	   ( takip.uSinavUcretTipiId = tip.Id )
Where FirmId = @FirmId

Group by 
   tip.KonuId
 , tip.KonuCaption   
 , tip.uSinavUcretTipi
 , tip.FormCaption 

END -- procedure

/*CreateProcedureEnd*/