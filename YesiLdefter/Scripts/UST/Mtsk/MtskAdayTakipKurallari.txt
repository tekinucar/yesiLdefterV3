/*CreateTable*/

begin transaction

 create table MtskAdayTakipKurallari
 (
   Id               Int IDENTITY(1,1) not null, 
   KonuGrupId       SmallInt       null,
   KonuId           Int            null,

   KuralAciklamasi  nvarchar(1000) null,

   constraint		pk_MtskAdayTakipKurallari primary key (Id)
 )
  
 grant select, insert, update, delete on MtskAdayTakipKurallari to public

 create index X_MtskAdayTakipKurallari01 on MtskAdayTakipKurallari (KonuGrupId, KonuId)
   
commit transaction

/*CreateTableEnd*/


MtskAdayTakip içi iki çeşit procedure olacak
   prc_MtskAdayTakipSingle
   prc_MtskAdayTakipFull
   MtskAdayTalep.Trigger



MtskAdayTalep trigger üzerinden



MtskAdayTakip.KayitTipiId :  

  BelgelerGeldi = 0 : MtskAdayTakip.KayitTipiId = 1
  BelgelerGeldi = 1 : MtskAdayTakip.KayitTipiId = 2

  MtskAdayBelgeler.BelgelerYuklendi = 1 and
  MtskAdayTalep.MebbisKurumOnayi = 1         :  MtskAdayTakip.KayitTipiId = 3

  MtskAdayTalep.MebbisKurumOnayi = 1 and
  MtskAdayTakip.KayitTipiId = 2              :  MtskAdayTakip.KayitTipiId = 3


MtskAdayTakip.ZamanlamaTipiId :

  prc_MtskAdayTakipFull  üzerinde

      MtskAdayTalep.DonemTipiId
      BugunDonemTipiId
      GelecekDonemTipiId
      IleriDonemTipiId

      Default : MtskAdayTakip.ZamanlamaTipiId = 0
      MtskAdayTalep.DonemTipiId < BugunDonemTipiId   : MtskAdayTakip.ZamanlamaTipiId = 1
      MtskAdayTalep.DonemTipiId = BugunDonemTipiId   : MtskAdayTakip.ZamanlamaTipiId = 2
      MtskAdayTalep.DonemTipiId = GelecekDonemTipiId : MtskAdayTakip.ZamanlamaTipiId = 3
      MtskAdayTalep.DonemTipiId > GelecekDonemTipiId : MtskAdayTakip.ZamanlamaTipiId = 4


MtskAdayTakip.IsGrupSubeYok :

  prc_MtskAdayTakipFull  üzerinde

      Default MtskAdayTakip.IsGrupSubeYok = 0
      MtskAdayTakip.KayitTipiId < 2 and 
      MtskAdayTakip.GrupTipiId = 0 or
      MtskAdayTakip.SubeTipiId = 2      :  MtskAdayTakip.IsGrupSubeYok = 1











