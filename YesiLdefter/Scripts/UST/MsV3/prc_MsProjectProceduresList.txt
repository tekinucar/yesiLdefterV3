
CREATE PROCEDURE [dbo].[prc_MsProjectProceduresList] ( 
    @managerDbName varchar(100) 
   ,@workDbName varchar(100) 
  )  
AS BEGIN

 /* 
 declare @managerDbName varchar(100) 
 declare @workDbName varchar(100) 
 set @managerDbName = 'MSV3DFTRBLT'
 set @workDbName = 'u7093888_Ustad01'
 */
 
 declare @cumle varchar(2000) 

 set @cumle = 
  '  select project.*
   , sch.name as Lkp_SchemaName
   , a.name as Lkp_ProcedureName
   , ''{workDb}'' as Lkp_DatabaseName
   from [{workDb}].sys.procedures as a 
      left outer join [{workDb}].sys.schemas as sch on ( a.schema_id = sch.schema_id ) 
      left outer join [{managerDb}].dbo.MsProjectProcedures project on ( a.name = project.ProcedureName )
   order by a.name '

  set @cumle = REPLACE(@cumle, '{workDb}', @workDbName) 
  set @cumle = REPLACE(@cumle, '{managerDb}', @managerDbName) 

  if ((@managerDbName = '') or
      (@managerDbName = 'null') or
      (@workDBName = '') or
      (@workDBName = 'null'))
  begin
    set @cumle = '
    select 
      ''sch.name'' as Lkp_SchemaName
    , ''procedureName'' as Lkp_ProcedureName 
	, ''databaseName'' as Lkp_DatabaseName '
  end
  
  execute(@cumle)  

END -- procedure


