
CREATE PROCEDURE [dbo].[prc_EduMtskYonetmelikDetailList] (@_XID int)  
AS BEGIN

--declare @_XID int  set @_XID = 180

declare @kat int 
declare @padding int 
set @kat = 1
set @padding = 20

;WITH CTE 
     AS  (
         Select emy.Id
		 , emy.Id Cte_Id
		 , CONVERT(varchar(25), emy.Id) AS sort
		 , @kat as kat
         From dbo.EduMtskYonetmelik as emy
         Where emy.IsActive = 1
		 and emy.Id = @_XID

		 Union all

		 Select cte.Cte_Id
		 , emy.Id
		 , CONVERT(varchar(25), cte.sort + ' > ' + CONVERT(varchar(25), emy.SiraNo) + convert(varchar(25), emy.Id) ) AS sort
		 , (cte.kat + 1) as kat
         From CTE as cte
		  Join dbo.EduMtskYonetmelik as emy
		     ON ( cte.Cte_Id = emy.parentId )
     )

  Select 
      --distinct emy.Id 
	   emy.Id
      ,emy.ParentId
	  ,emy.Konu
      ,emy.ContentHTML
      ,emy.ImageName1, emy.ImageAbout1, emy.ImageWidth1, emy.ImageHeight1
      ,emy.ImageName2, emy.ImageAbout2, emy.ImageWidth2, emy.ImageHeight2
      ,emy.ImageName3, emy.ImageAbout3, emy.ImageWidth3, emy.ImageHeight3
      ,emy.ImageName4, emy.ImageAbout4, emy.ImageWidth1, emy.ImageHeight4
	  ,cte.sort
	  ,cte.kat * @padding as padding
	  
   from CTE as cte
    left outer join dbo.EduMtskYonetmelik as emy on ( cte.Cte_Id = emy.Id )
	
   where cte.Cte_Id is not null
   and emy.IsActive = 1
   order by cte.sort
 

END -- procedure

