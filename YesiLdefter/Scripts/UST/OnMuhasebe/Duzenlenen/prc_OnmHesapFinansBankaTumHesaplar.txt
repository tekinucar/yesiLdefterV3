
/*CreateProcedure*/
-- FirmId, UstGrupTipiId, AnaGrupTipiId, HesapKodu

CREATE PROCEDURE [dbo].[prc_OnmHesapFinansMaliyetGrubuKontrolu](
 @FirmId int 
,@UstGrupTipiId smallInt 
,@AnaGrupTipiId smallInt 
,@HesapKodu varchar(100)
)  
AS BEGIN  

    Declare @id int;  
    set @id = 0

    select @id = Id
    from [dbo].[OnmHesapFinans] as hf
    Where hf.FirmId = @FirmId
    and   hf.UstGrupTipiId = @UstGrupTipiId
    and   hf.AnaGrupTipiId = @AnaGrupTipiId
    and   hf.HesapKodu = @HesapKodu

    if (@id = 0)
    begin
      INSERT INTO [dbo].[OnmHesapFinans]
           ([ParentId]
           ,[FirmId]
           ,[IsActive]
           ,[UstGrupTipiId]
           ,[AnaGrupTipiId]
           ,[AltGrupTipiId]
           ,[AltCesitTipiId]
           ,[HesapTipiId]
           ,[HesapKodu]
           ,[UstHesapKodu]
           ,[HesapKisaAdi]
           ,[HesapAdi]
           ,[BAHesapTipiId]
           ,[KdvOrani]
           ,[IsKiralik]
           )
      Select 
            0 --ParentId
           ,@FirmId --FirmId
           ,1 --IsActive
           ,@UstGrupTipiId --UstGrupTipiId
           ,AnaGrupTipiId
           ,AltGrupTipiId
           ,AltCesitTipiId
           ,11 -- HesapTipiId  ??????
           ,HesapKodu
           ,UstHesapKodu
           ,HesapAdi --HesapKisaAdi
           ,HesapAdi
           ,BAHesapTipiId
           ,KdvOrani
           ,IsKiralik
      from Lkp.OnmHesapMaster
      where 0 = 0
      and UstGrupTipiId = 82
      and AnaGrupTipiId = @AnaGrupTipiId
      and HesapKodu = @HesapKodu
      --and UstHesapKodu = @UstHesapKodu

    end

END

/*CreateProcedureEnd*/




/*CreateProcedure*/

CREATE PROCEDURE [dbo].[prc_OnmHesapFinansBankaTumHesaplar]   
AS BEGIN
  --(@firmId int) 
  --declare @firmId int = 14
  
 -- Bankalar
 Select 
   [HBanka].[Id]
 , [HBanka].[ParentId]
 , [HBanka].[FirmId]
 , [HBanka].[IsActive]
 , [HBanka].[UstGrupTipiId]
 , [HBanka].[AnaGrupTipiId]
 , [HBanka].[AltGrupTipiId]
 , [HBanka].[AltCesitTipiId]
 , [HBanka].[HesapKodu]
 , [HBanka].[HesapKisaAdi]
 , [HBanka].[HesapAdi]
 , [HBanka].[Numarasi]
 , [HBanka].[IBANNumarasi]
 , '' as Lkp_AltCesitTipi
 , '' as Lkp_ParaAdi

 From [dbo].[OnmHesapFinans] as [HBanka]
 Where 0 = 0 
 and HBanka.UstGrupTipiId = 10
 and HBanka.AltGrupTipiId = 1020
 
 union all 

 -- Şubeler
 Select 
   [HBanka].[Id]
 , [HBanka].[ParentId]
 , [HBanka].[FirmId]
 , [HBanka].[IsActive]
 , [HBanka].[UstGrupTipiId]
 , [HBanka].[AnaGrupTipiId]
 , [HBanka].[AltGrupTipiId]
 , [HBanka].[AltCesitTipiId]
 , [HBanka].[HesapKodu]
 , [HBanka].[HesapKisaAdi]
 , [HBanka].[HesapAdi]
 , [HBanka].[Numarasi]
 , [HBanka].[IBANNumarasi]
 , '' as Lkp_AltCesitTipi
 , '' as Lkp_ParaAdi

 From [dbo].[OnmHesapFinans] as [HBanka]
 Where 0 = 0 
 and HBanka.UstGrupTipiId = 10
 and HBanka.AltGrupTipiId = 1021

 union all 

 -- Hesaplar    
 Select 
   [HBanka].[Id]
 , [HBanka].[ParentId]
 , [HBanka].[FirmId]
 , [HBanka].[IsActive]
 , [HBanka].[UstGrupTipiId]
 , [HBanka].[AnaGrupTipiId]
 , [HBanka].[AltGrupTipiId]
 , [HBanka].[AltCesitTipiId]
 , [HBanka].[HesapKodu]
 , [HBanka].[HesapKisaAdi]
 , [HBanka].[HesapAdi]
 , [HBanka].[Numarasi]
 , [HBanka].[IBANNumarasi]
 -- LookUp fields
 , [FNo8].[AltCesitTipi] as Lkp_AltCesitTipi
 , [FNo31].[ParaAdi] as Lkp_ParaAdi
 From [dbo].[OnmHesapFinans] as [HBanka]
    left outer join Lkp.OnmHesapFinansAltCesitTipi as FNo8 on ( HBanka.AltCesitTipiId = FNo8.Id )
    left outer join Lkp.OnmParaTipi as FNo31 on ( HBanka.ParaTipiId = FNo31.ParaKodu )
 Where 0 = 0 
 and HBanka.UstGrupTipiId = 10
 and HBanka.AltGrupTipiId = 1022
 
 union all 

 -- Kredi kartları
 Select 
   [HBanka].[Id]
 , [HBanka].[ParentId]
 , [HBanka].[FirmId]
 , [HBanka].[IsActive]
 , [HBanka].[UstGrupTipiId]
 , [HBanka].[AnaGrupTipiId]
 , [HBanka].[AltGrupTipiId]
 , [HBanka].[AltCesitTipiId]
 , [HBanka].[HesapKodu]
 , [HBanka].[HesapKisaAdi]
 , [HBanka].[HesapAdi]
 , [HBanka].[Numarasi]
 , [HBanka].[IBANNumarasi]
 -- LookUp fields
 , [FNo8].[AltCesitTipi] as Lkp_AltCesitTipi
 , [FNo31].[ParaAdi] as Lkp_ParaAdi

 From [dbo].[OnmHesapFinans] as [HBanka]
    left outer join Lkp.OnmHesapFinansAltCesitTipi as FNo8 on ( HBanka.AltCesitTipiId = FNo8.Id )
    left outer join Lkp.OnmParaTipi as FNo31 on ( HBanka.ParaTipiId = FNo31.ParaKodu )
 Where 0 = 0 
 and HBanka.UstGrupTipiId = 10
 and HBanka.AltGrupTipiId = 1023

 union all 

 -- Pos Cihazlar
 Select 
   [HBanka].[Id]
 , [HBanka].[ParentId]
 , [HBanka].[FirmId]
 , [HBanka].[IsActive]
 , [HBanka].[UstGrupTipiId]
 , [HBanka].[AnaGrupTipiId]
 , [HBanka].[AltGrupTipiId]
 , [HBanka].[AltCesitTipiId]
 , [HBanka].[HesapKodu]
 , [HBanka].[HesapKisaAdi]
 , [HBanka].[HesapAdi]
 , [HBanka].[Numarasi]
 , [HBanka].[IBANNumarasi]
 -- LookUp fields
 , [FNo8].[AltCesitTipi] as Lkp_AltCesitTipi
 , [FNo31].[ParaAdi] as Lkp_ParaAdi

 From [dbo].[OnmHesapFinans] as [HBanka]
    left outer join Lkp.OnmHesapFinansAltCesitTipi as FNo8 on ( HBanka.AltCesitTipiId = FNo8.Id )
    left outer join Lkp.OnmParaTipi as FNo31 on ( HBanka.ParaTipiId = FNo31.ParaKodu )

 Where 0 = 0 
 and HBanka.UstGrupTipiId = 10
 and HBanka.AltGrupTipiId = 1024




END -- procedure

/*CreateProcedureEnd*/