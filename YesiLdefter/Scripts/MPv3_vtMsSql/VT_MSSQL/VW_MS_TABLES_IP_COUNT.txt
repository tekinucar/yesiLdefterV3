
CREATE VIEW [dbo].[VW_MS_TABLES_IP_COUNT]  
AS
 (

  SELECT 
    C.TABLE_CODE                    LKP_TABLE_CODE 
  , C.IP_CODE                       LKP_IP_CODE
  , C.TABLE_CODE + '.' + C.IP_CODE  LKP_TABLEIP_CODE 
  , SUM(MASTER_DETAIL_ADET)         LKP_MASTER_DETAIL_ADET
  , SUM(PROP_NAVIGATOR_ADET)        LKP_PROP_NAVIGATOR_ADET
  , SUM(PROP_SUBVIEW_ADET)          LKP_PROP_SUBVIEW_ADET
  , SUM(PROP_RUNTIME_ADET)          LKP_PROP_RUNTIME_ADET
  , SUM(PROP_SEARCH_ADET)           LKP_PROP_SEARCH_ADET
  FROM  (
  -- BİR IPDE KULLANILAN MASTER_DETAIL SAYISI
     SELECT TABLE_CODE, IP_CODE 
     , COUNT(REF_ID) MASTER_DETAIL_ADET 
     , 0 PROP_NAVIGATOR_ADET
     , 0 PROP_SUBVIEW_ADET
     , 0 PROP_RUNTIME_ADET
     , 0 PROP_SEARCH_ADET
     FROM MS_FIELDS_IP 
     WHERE DEFAULT_TYPE = 31
     GROUP BY TABLE_CODE, IP_CODE

     UNION ALL 

  -- PROP_NAVIGATOR İÇİNDE KULLANILAN IP SAYISI
     SELECT B.TABLE_CODE, B.IP_CODE 
     , 0 MASTER_DETAIL_ADET 
     , COUNT(B.TABLEIPCODE) PROP_NAVIGATOR_ADET 
     , 0 PROP_SUBVIEW_ADET
     , 0 PROP_RUNTIME_ADET
     , 0 PROP_SEARCH_ADET 
     FROM (
        SELECT A.TABLE_CODE, A.IP_CODE, X.TABLEIPCODE FROM MS_TABLES_IP A
           LEFT OUTER JOIN 
             (
              SELECT TABLE_CODE + '.' + IP_CODE TABLEIPCODE FROM MS_TABLES_IP 
             ) X ON ( X.TABLEIPCODE <> '')
        WHERE A.PROP_NAVIGATOR LIKE '%' + X.TABLEIPCODE +'%'
     ) B
     GROUP BY B.TABLE_CODE, B.IP_CODE

     UNION ALL 

  -- PROP_SUBVIEW İÇİNDE KULLANILAN IP SAYISI
     SELECT B.TABLE_CODE, B.IP_CODE  
     , 0 MASTER_DETAIL_ADET 
     , 0 PROP_NAVIGATOR_ADET
     , COUNT(B.TABLEIPCODE) PROP_SUBVIEW_ADET 
     , 0 PROP_RUNTIME_ADET
     , 0 PROP_SEARCH_ADET
     FROM (
        SELECT A.TABLE_CODE, A.IP_CODE, X.TABLEIPCODE FROM MS_TABLES_IP A
           LEFT OUTER JOIN 
           (
            SELECT TABLE_CODE + '.' + IP_CODE TABLEIPCODE FROM MS_TABLES_IP 
           ) X ON ( X.TABLEIPCODE <> '')
        WHERE A.PROP_SUBVIEW LIKE '%' + X.TABLEIPCODE +'%'
     ) B
     GROUP BY B.TABLE_CODE, B.IP_CODE

     UNION ALL 

  -- PROP_RUNTIME İÇİNDE KULLANILAN IP SAYISI
     SELECT B.TABLE_CODE, B.IP_CODE
     , 0 MASTER_DETAIL_ADET 
     , 0 PROP_NAVIGATOR_ADET
     , 0 PROP_SUBVIEW_ADET
     , COUNT(B.TABLEIPCODE)  PROP_RUNTIME_ADET
     , 0 PROP_SEARCH_ADET
     FROM (
        SELECT A.TABLE_CODE, A.IP_CODE, X.TABLEIPCODE FROM MS_TABLES_IP A
           LEFT OUTER JOIN 
             (
              SELECT TABLE_CODE + '.' + IP_CODE TABLEIPCODE FROM MS_TABLES_IP 
             ) X ON ( X.TABLEIPCODE <> '')
        WHERE A.PROP_RUNTIME LIKE '%' + X.TABLEIPCODE +'%'
     ) B
     GROUP BY B.TABLE_CODE, B.IP_CODE

     UNION ALL 

  -- PROP_SEARCH İÇİNDE KULLANILAN IP SAYISI
     SELECT B.TABLE_CODE, B.IP_CODE 
     , 0 MASTER_DETAIL_ADET 
     , 0 PROP_NAVIGATOR_ADET
     , 0 PROP_SUBVIEW_ADET
     , 0 PROP_RUNTIME_ADET
     , COUNT(B.TABLEIPCODE) PROP_SEARCH_ADET
	 FROM (
        SELECT A.TABLE_CODE, A.IP_CODE, X.TABLEIPCODE FROM MS_TABLES_IP A
           LEFT OUTER JOIN 
             (
              SELECT TABLE_CODE + '.' + IP_CODE TABLEIPCODE FROM MS_TABLES_IP 
             ) X ON ( X.TABLEIPCODE <> '')
        WHERE A.PROP_SEARCH LIKE '%' + X.TABLEIPCODE +'%'
     ) B
     GROUP BY B.TABLE_CODE, B.IP_CODE

 ) C 

GROUP BY C.TABLE_CODE, C.IP_CODE

 )





/*
-- BİR IPDE KULLANILAN MASTER_DETAIL SAYISI
SELECT TABLE_CODE, IP_CODE, COUNT(REF_ID) MASTER_DETAIL_ADET FROM MS_FIELDS_IP 
WHERE DEFAULT_TYPE = 31
GROUP BY TABLE_CODE, IP_CODE

-- PROP_NAVIGATOR İÇİNDE KULLANILAN IP SAYISI
SELECT B.TABLE_CODE, B.IP_CODE, COUNT(B.TABLEIPCODE) PROP_NAVIGATOR_ADET FROM (
  SELECT A.TABLE_CODE, A.IP_CODE, X.TABLEIPCODE FROM MS_TABLES_IP A
    LEFT OUTER JOIN 
    (
      SELECT TABLE_CODE + '.' + IP_CODE TABLEIPCODE FROM MS_TABLES_IP 
     ) X ON ( X.TABLEIPCODE <> '')
  WHERE A.PROP_NAVIGATOR LIKE '%' + X.TABLEIPCODE +'%'
) B
GROUP BY B.TABLE_CODE, B.IP_CODE


-- PROP_SUBVIEW İÇİNDE KULLANILAN IP SAYISI
SELECT B.TABLE_CODE, B.IP_CODE, COUNT(B.TABLEIPCODE) PROP_SUBVIEW_ADET FROM (
  SELECT A.TABLE_CODE, A.IP_CODE, X.TABLEIPCODE FROM MS_TABLES_IP A
    LEFT OUTER JOIN 
    (
      SELECT TABLE_CODE + '.' + IP_CODE TABLEIPCODE FROM MS_TABLES_IP 
    ) X ON ( X.TABLEIPCODE <> '')
  WHERE A.PROP_SUBVIEW LIKE '%' + X.TABLEIPCODE +'%'
) B
GROUP BY B.TABLE_CODE, B.IP_CODE

-- PROP_RUNTIME İÇİNDE KULLANILAN IP SAYISI
SELECT B.TABLE_CODE, B.IP_CODE, COUNT(B.TABLEIPCODE) PROP_RUNTIME_ADET FROM (
  SELECT A.TABLE_CODE, A.IP_CODE, X.TABLEIPCODE FROM MS_TABLES_IP A
    LEFT OUTER JOIN 
    (
      SELECT TABLE_CODE + '.' + IP_CODE TABLEIPCODE FROM MS_TABLES_IP 
    ) X ON ( X.TABLEIPCODE <> '')
  WHERE A.PROP_RUNTIME LIKE '%' + X.TABLEIPCODE +'%'
) B
GROUP BY B.TABLE_CODE, B.IP_CODE


-- PROP_SEARCH İÇİNDE KULLANILAN IP SAYISI
SELECT B.TABLE_CODE, B.IP_CODE, COUNT(B.TABLEIPCODE) PROP_SEARCH_ADET FROM (
  SELECT A.TABLE_CODE, A.IP_CODE, X.TABLEIPCODE FROM MS_TABLES_IP A
    LEFT OUTER JOIN 
    (
      SELECT TABLE_CODE + '.' + IP_CODE TABLEIPCODE FROM MS_TABLES_IP 
    ) X ON ( X.TABLEIPCODE <> '')
  WHERE A.PROP_SEARCH LIKE '%' + X.TABLEIPCODE +'%'
) B
GROUP BY B.TABLE_CODE, B.IP_CODE




/* ************************************* */


-- BİR IP YE BAĞLI DİĞER IP LİSTESİ
SELECT DISTINCT(MASTER_TABLEIPCODE) TABLEIPCODE, TABLE_CODE, IP_CODE   FROM MS_FIELDS_IP 
WHERE DEFAULT_TYPE = 31
ORDER BY TABLE_CODE, IP_CODE

-- PROP_NAVIGATOR İÇİNDE KULLANILAN IP LER
SELECT A.TABLE_CODE, A.IP_CODE, X.TABLEIPCODE FROM MS_TABLES_IP A
  LEFT OUTER JOIN 
  (
    SELECT TABLE_CODE + '.' + IP_CODE TABLEIPCODE FROM MS_TABLES_IP 
  ) X ON ( X.TABLEIPCODE <> '')
WHERE A.PROP_NAVIGATOR LIKE '%' + X.TABLEIPCODE +'%'

-- PROP_SUBVIEW İÇİNDE KULLANILAN IP LER
SELECT A.TABLE_CODE, A.IP_CODE, X.TABLEIPCODE FROM MS_TABLES_IP A
  LEFT OUTER JOIN 
  (
    SELECT TABLE_CODE + '.' + IP_CODE TABLEIPCODE FROM MS_TABLES_IP 
  ) X ON ( X.TABLEIPCODE <> '')
WHERE A.PROP_SUBVIEW LIKE '%' + X.TABLEIPCODE +'%'

-- PROP_RUNTIME İÇİNDE KULLANILAN IP LER
SELECT A.TABLE_CODE, A.IP_CODE, X.TABLEIPCODE FROM MS_TABLES_IP A
  LEFT OUTER JOIN 
  (
    SELECT TABLE_CODE + '.' + IP_CODE TABLEIPCODE FROM MS_TABLES_IP 
  ) X ON ( X.TABLEIPCODE <> '')

WHERE A.PROP_RUNTIME LIKE '%' + X.TABLEIPCODE +'%'

  

-- PROP_SEARCH İÇİNDE KULLANILAN IP LER
SELECT A.TABLE_CODE, A.IP_CODE, X.TABLEIPCODE FROM MS_TABLES_IP A
  LEFT OUTER JOIN 
  (
    SELECT TABLE_CODE + '.' + IP_CODE TABLEIPCODE FROM MS_TABLES_IP 
  ) X ON ( X.TABLEIPCODE <> '')

WHERE A.PROP_SEARCH LIKE '%' + X.TABLEIPCODE +'%'



-- EXTERNAL_IP_CODE İÇİNDE KULLANILAN IP LER
SELECT A.TABLE_CODE, A.IP_CODE, X.TABLEIPCODE FROM MS_TABLES_IP A
  LEFT OUTER JOIN 
  (
    SELECT TABLE_CODE + '.' + IP_CODE TABLEIPCODE FROM MS_TABLES_IP 
  ) X ON ( X.TABLEIPCODE <> '')

WHERE A.EXTERNAL_IP_CODE LIKE '%' + X.TABLEIPCODE +'%'




-- EKRANLARDA KULLANILAN IP LER
SELECT MASTER_CODE, TABLEIPCODE, TABLEIPCODE2 FROM MS_LAYOUT 
WHERE LAYOUT_TYPE <> 'menu' 
AND ( 
    (TABLEIPCODE IS NOT NULL AND TABLEIPCODE <> '') 
 OR (TABLEIPCODE2 IS NOT NULL AND TABLEIPCODE2 <> '')
 )




-- MENU DEKİ PROP_NAVIGATOR İÇİNDE KULLANILAN IP LER
SELECT A.MODUL_CODE, A.MASTER_CODE, A.ITEM_CODE, X.TABLEIPCODE FROM MS_ITEMS A
  LEFT OUTER JOIN 
  (
    SELECT TABLE_CODE + '.' + IP_CODE TABLEIPCODE FROM MS_TABLES_IP 
  ) X ON ( X.TABLEIPCODE <> '')

WHERE A.PROP_NAVIGATOR LIKE '%' + X.TABLEIPCODE +'%'

*/







